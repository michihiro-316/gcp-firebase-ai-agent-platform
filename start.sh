#!/bin/bash
# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘  start.sh - é–‹ç™ºç’°å¢ƒèµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ                                â•‘
# â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
# â•‘                                                                  â•‘
# â•‘  ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã‚’è‡ªå‹•ã§è¡Œã„ã¾ã™ï¼š                           â•‘
# â•‘  1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆPython/Flaskï¼‰ã®èµ·å‹•                           â•‘
# â•‘  2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆReact/Viteï¼‰ã®èµ·å‹•                           â•‘
# â•‘  3. æ¥ç¶šç¢ºèª                                                     â•‘
# â•‘                                                                  â•‘
# â•‘  ğŸ“š è©³ç´°: docs/learning/md/06_ã‚³ãƒãƒ³ãƒ‰è§£èª¬.md                     â•‘
# â•‘                                                                  â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

set -e  # ã‚¨ãƒ©ãƒ¼æ™‚ã«åœæ­¢

# è‰²ã®å®šç¾©
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ç§»å‹•
cd "$(dirname "$0")"
PROJECT_ROOT=$(pwd)

echo ""
echo -e "${BLUE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${BLUE}â•‘  ğŸš€ AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–‹ç™ºç’°å¢ƒã‚’èµ·å‹•ã—ã¾ã™                      â•‘${NC}"
echo -e "${BLUE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Step 1: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰èµ·å‹•
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo -e "${YELLOW}â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”${NC}"
echo -e "${YELLOW}â”‚ Step 1/3: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰èµ·å‹•                                  â”‚${NC}"
echo -e "${YELLOW}â”‚                                                             â”‚${NC}"
echo -e "${YELLOW}â”‚ ğŸ“ å ´æ‰€: backend/main.py                                    â”‚${NC}"
echo -e "${YELLOW}â”‚ ğŸ”§ å½¹å‰²: AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®APIï¼ˆãƒãƒ£ãƒƒãƒˆå‡¦ç†ï¼‰                 â”‚${NC}"
echo -e "${YELLOW}â”‚ ğŸŒ URL:  http://localhost:8080                              â”‚${NC}"
echo -e "${YELLOW}â”‚                                                             â”‚${NC}"
echo -e "${YELLOW}â”‚ ğŸ“š è©³ç´°: docs/learning/md/03_ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è§£èª¬.md             â”‚${NC}"
echo -e "${YELLOW}â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${NC}"

cd "$PROJECT_ROOT/backend"

# ä»®æƒ³ç’°å¢ƒã®ãƒã‚§ãƒƒã‚¯
if [ -d "venv" ]; then
    source venv/bin/activate
elif [ -d ".venv" ]; then
    source .venv/bin/activate
fi

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èµ·å‹•
python -m functions_framework --target=main --port=8080 --debug &
BACKEND_PID=$!
sleep 2

# èµ·å‹•ç¢ºèª
if curl -s http://localhost:8080/health > /dev/null 2>&1; then
    echo -e "   ${GREEN}âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰èµ·å‹•å®Œäº†${NC}"
else
    echo -e "   ${GREEN}âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰èµ·å‹•ä¸­...ï¼ˆåˆå›ã¯æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ï¼‰${NC}"
fi
echo ""

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Step 2: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo -e "${YELLOW}â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”${NC}"
echo -e "${YELLOW}â”‚ Step 2/3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•                                â”‚${NC}"
echo -e "${YELLOW}â”‚                                                             â”‚${NC}"
echo -e "${YELLOW}â”‚ ğŸ“ å ´æ‰€: frontend/src/App.tsx                               â”‚${NC}"
echo -e "${YELLOW}â”‚ ğŸ”§ å½¹å‰²: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã‚‹ç”»é¢ï¼ˆReactï¼‰                        â”‚${NC}"
echo -e "${YELLOW}â”‚ ğŸŒ URL:  http://localhost:5173                              â”‚${NC}"
echo -e "${YELLOW}â”‚                                                             â”‚${NC}"
echo -e "${YELLOW}â”‚ ğŸ“š è©³ç´°: docs/learning/md/04_ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è§£èª¬.md          â”‚${NC}"
echo -e "${YELLOW}â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${NC}"

cd "$PROJECT_ROOT/frontend"

# node_modulesãŒãªã‘ã‚Œã°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
if [ ! -d "node_modules" ]; then
    echo "   ğŸ“¦ ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
    npm install
fi

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èµ·å‹•
npm run dev &
FRONTEND_PID=$!
sleep 3

echo -e "   ${GREEN}âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•å®Œäº†${NC}"
echo ""

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Step 3: æ¥ç¶šç¢ºèª
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo -e "${YELLOW}â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”${NC}"
echo -e "${YELLOW}â”‚ Step 3/3: ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ                                      â”‚${NC}"
echo -e "${YELLOW}â”‚                                                             â”‚${NC}"
echo -e "${YELLOW}â”‚ ğŸ“¡ ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œ:                                            â”‚${NC}"
echo -e "${YELLOW}â”‚                                                             â”‚${NC}"
echo -e "${YELLOW}â”‚    [ãƒ–ãƒ©ã‚¦ã‚¶]  â†’  [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰]  â†’  [AI (Vertex AI)]       â”‚${NC}"
echo -e "${YELLOW}â”‚    :5173          :8080              Gemini                 â”‚${NC}"
echo -e "${YELLOW}â”‚                                                             â”‚${NC}"
echo -e "${YELLOW}â”‚ ğŸ’¡ è©³ç´°: docs/learning/md/11_ãƒãƒ£ãƒƒãƒˆé€ä¿¡ã®æµã‚Œ.md          â”‚${NC}"
echo -e "${YELLOW}â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${NC}"
echo ""

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo -e "${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${GREEN}â•‘  âœ… èµ·å‹•å®Œäº†ï¼                                              â•‘${NC}"
echo -e "${GREEN}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
echo -e "${GREEN}â•‘                                                            â•‘${NC}"
echo -e "${GREEN}â•‘  ğŸŒ ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã: http://localhost:5173                  â•‘${NC}"
echo -e "${GREEN}â•‘                                                            â•‘${NC}"
echo -e "${GREEN}â•‘  ğŸ“ AIã‚’ç·¨é›†ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«:                                  â•‘${NC}"
echo -e "${GREEN}â•‘     backend/agents/_template/agent.py                      â•‘${NC}"
echo -e "${GREEN}â•‘                                                            â•‘${NC}"
echo -e "${GREEN}â•‘  ğŸ“š ä»•çµ„ã¿ã‚’ç†è§£ã™ã‚‹:                                      â•‘${NC}"
echo -e "${GREEN}â•‘     docs/learning/md/02_å…¨ä½“åƒ.md ã‹ã‚‰èª­ã¿å§‹ã‚ã‚‹           â•‘${NC}"
echo -e "${GREEN}â•‘                                                            â•‘${NC}"
echo -e "${GREEN}â•‘  â¹  åœæ­¢ã™ã‚‹ã«ã¯: Ctrl+C                                   â•‘${NC}"
echo -e "${GREEN}â•‘                                                            â•‘${NC}"
echo -e "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""

# çµ‚äº†æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
cleanup() {
    echo ""
    echo "ğŸ›‘ ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ä¸­..."
    kill $BACKEND_PID 2>/dev/null
    kill $FRONTEND_PID 2>/dev/null
    echo "âœ… åœæ­¢å®Œäº†"
    exit 0
}

trap cleanup SIGINT SIGTERM

# ãƒ—ãƒ­ã‚»ã‚¹ã‚’å¾…æ©Ÿ
wait
