# AIカスタマイズ

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                                                                              ║
║   🎨 AIカスタマイズ                                                           ║
║                                                                              ║
║   「AIの性格を変えてみよう！」                                                 ║
║   「プロンプトを変えるだけで全然違う応答になる」                                ║
║                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════╝
```

---

## この章で学ぶこと

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  📚 学習目標                                                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  1. SYSTEM_PROMPT の変更方法                                                │
│  2. AIの性格・役割のカスタマイズ                                              │
│  3. 顧客別AIの作成                                                           │
│  4. パラメータ調整（モデル、温度など）                                        │
│                                                                             │
│  ⏱️ 想定学習時間: 15分                                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 基本: SYSTEM_PROMPT を変更する

AIの性格・役割は `SYSTEM_PROMPT` で決まります。

### ファイルの場所

```
backend/src/agents/_template/agent.py
```

### 変更箇所

```python
# =============================================
# ここを編集してAIをカスタマイズ
# =============================================

SYSTEM_PROMPT = """あなたは親切で丁寧なAIアシスタントです。
ユーザーの質問に対して、わかりやすく簡潔に回答してください。
日本語で回答してください。"""
```

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  💡 SYSTEM_PROMPT とは？                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  AIに「あなたはこういう役割です」と教える指示文                                │
│                                                                             │
│  【人間に例えると】                                                          │
│  「あなたは今日からカスタマーサポートとして働きます。                          │
│   お客様には丁寧に、わかりやすく説明してください。」                           │
│  と伝えるようなもの                                                          │
│                                                                             │
│  SYSTEM_PROMPT を変えると、AIの応答スタイルが変わる！                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 実験してみよう

### 実験1: 関西弁AIに変える

```python
SYSTEM_PROMPT = """あなたは関西弁で話すAIアシスタントやで。
ユーザーの質問にフレンドリーに答えてや。
「やで」「やん」「なんでやねん」などを使ってな。"""
```

**結果例:**
```
ユーザー: こんにちは
AI: おお、こんにちは〜！元気にしとる？なんか聞きたいことあったら言うてな！
```

---

### 実験2: 専門家AIに変える

```python
SYSTEM_PROMPT = """あなたはPythonプログラミングの専門家です。
コードの書き方、デバッグ方法、ベストプラクティスを教えてください。
初心者にも分かりやすく説明してください。
コード例は必ず含めてください。"""
```

**結果例:**
```
ユーザー: リストの使い方を教えて
AI: Pythonのリストについて説明しますね！

リストは複数の値をまとめて格納できるデータ構造です。

# リストの作成
fruits = ["りんご", "みかん", "バナナ"]

# 要素の追加
fruits.append("ぶどう")

# 要素の取得
print(fruits[0])  # "りんご"
...
```

---

### 実験3: キャラクターAIに変える

```python
SYSTEM_PROMPT = """あなたは「AIくん」という名前のAIキャラクターです。
一人称は「ボク」で、語尾に「〜だよ」「〜なんだ」をつけて話します。
明るく元気な性格で、ユーザーを励まします。
絵文字を適度に使ってください。"""
```

**結果例:**
```
ユーザー: 疲れた
AI: 疲れちゃったんだね 😢 でも大丈夫だよ！
ボクが応援してるから、少し休んでまた頑張ろう！💪✨
何かボクにできることがあったら言ってね！
```

---

## 変更を確認する手順

### 1. agent.py を編集

```bash
# VSCode で開く
code backend/src/agents/_template/agent.py

# または vim で開く
vim backend/src/agents/_template/agent.py
```

### 2. バックエンドを再起動

```bash
cd backend
# Ctrl+C で停止してから再起動
functions-framework --target=main --port=8080
```

### 3. ブラウザでチャット

http://localhost:5173/ でチャットして確認

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  ⚠️ 重要な注意                                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  プロンプトを変更したら必ず再起動が必要！                                      │
│                                                                             │
│  Python のコードを変更しても、サーバーを再起動しないと反映されない              │
│  （フロントエンドはホットリロードで自動反映されるけど、バックエンドは違う）     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 顧客別にカスタマイズする場合

### 1. テンプレートをコピー

```bash
cd backend/src/agents
cp -r _template acme-corp
```

### 2. agent.py を編集

```python
# agents/acme-corp/agent.py

class AcmeCorpAgent(BaseAgent):
    SYSTEM_PROMPT = """あなたはACME社の専門AIアシスタントです。
ACME社の製品・サービスに関する質問に答えてください。
丁寧な言葉遣いで、正確な情報を提供してください。"""
```

### 3. main.py に登録

```python
from agents.acme_corp.agent import AcmeCorpAgent

AGENTS = {
    "template": TemplateAgent,
    "acme-corp": AcmeCorpAgent,  # 追加
}
```

### 4. 設定ファイルを作成

```bash
cp customer-configs/template.env customer-configs/acme-corp.env
```

```env
CUSTOMER_ID=acme-corp
DEFAULT_AGENT=acme-corp
```

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  🏢 顧客別カスタマイズの使いどころ                                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ・A社: 製品サポート特化のAI                                                 │
│  ・B社: 社内FAQ特化のAI                                                      │
│  ・C社: 営業支援特化のAI                                                     │
│                                                                             │
│  同じシステムで、顧客ごとに違うAIを提供できる！                               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## その他のカスタマイズ

### モデルを変更

```python
# より高性能なモデルを使う（コストは上がる）
MODEL_NAME = "gemini-1.5-pro"

# 高速だが簡易なモデル（コストは下がる）
MODEL_NAME = "gemini-1.5-flash"
```

### 会話履歴の量を変更

```python
# より長い会話を記憶する（コストは上がる）
MAX_HISTORY_MESSAGES = 40  # 約20往復分

# 短い会話（コストは下がる）
MAX_HISTORY_MESSAGES = 10  # 約5往復分
```

### 応答の創造性を変更

```python
# temperature を変更
self.llm = ChatVertexAI(
    model=self.MODEL_NAME,
    temperature=0.3,  # 低い = 一貫した応答、高い = 創造的な応答
    ...
)
```

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  🌡️ temperature とは？                                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   0.0 ────────────────────────────────────────────────────────── 1.0        │
│   │                                                               │          │
│   ▼                                                               ▼          │
│  一貫性重視                                                    創造性重視    │
│  ・同じ質問に同じ回答                                          ・多様な回答  │
│  ・事実確認向き                                                ・発想力重視  │
│  ・FAQ、カスタマーサポート                                      ・創作、ブレスト│
│                                                                             │
│  【おすすめ値】                                                              │
│  ・カスタマーサポート: 0.2〜0.4                                              │
│  ・一般的な会話: 0.5〜0.7                                                    │
│  ・クリエイティブ作業: 0.8〜1.0                                              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 効果的なプロンプトの書き方

### 良いプロンプトの例

```python
SYSTEM_PROMPT = """あなたは株式会社ABCのカスタマーサポートAIです。

【役割】
- お客様からの問い合わせに丁寧に回答する
- 製品の使い方、トラブルシューティングを支援する

【話し方】
- 敬語を使う
- 簡潔に、わかりやすく説明する
- 箇条書きを活用する

【注意事項】
- 価格や契約に関する質問は「営業担当にお問い合わせください」と案内する
- 技術的に難しい質問は「サポートチームに転送します」と案内する
- わからないことは「わからない」と正直に伝える

【禁止事項】
- 競合他社の悪口を言わない
- 根拠のない情報を伝えない
"""
```

### ポイント

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  ✍️ 効果的なプロンプトのコツ                                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  1. 役割を明確に                                                             │
│     「あなたは〇〇です」と具体的に伝える                                       │
│                                                                             │
│  2. 話し方を指定                                                             │
│     敬語、カジュアル、専門用語の使用など                                       │
│                                                                             │
│  3. できること・できないことを明示                                            │
│     「〇〇の質問には対応できない」など                                         │
│                                                                             │
│  4. 具体例を入れる                                                           │
│     「例えば〇〇と聞かれたら△△と答える」                                      │
│                                                                             │
│  5. 禁止事項を明記                                                           │
│     「〇〇してはいけない」と明示的に書く                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 注意事項

- プロンプトを変更したら必ず再起動が必要
- 本番環境に反映するにはデプロイが必要
- モデル変更はコストに影響する
- プロンプトが長すぎると処理が遅くなる

---

## まとめ

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                                                                              ║
║   🎓 この章で学んだこと                                                       ║
║                                                                              ║
║   ✅ SYSTEM_PROMPT でAIの性格・役割を変更できる                               ║
║   ✅ 顧客別にカスタマイズしたAIを作成できる                                    ║
║   ✅ temperature で応答の創造性を調整できる                                   ║
║   ✅ 効果的なプロンプトの書き方                                               ║
║                                                                              ║
║   これで1日の学習は完了です！お疲れ様でした！                                  ║
║                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════╝
```

---

## 次のステップ（発展編）

| 内容 | 説明 |
|------|------|
| ツールの追加 | AIに計算や検索の能力を追加 |
| 条件分岐 | 質問内容によって処理を分ける |
| 外部API連携 | 天気予報や株価などの情報を取得 |

より複雑なエージェントについては LangGraph のドキュメントを参照:
https://langchain-ai.github.io/langgraph/
