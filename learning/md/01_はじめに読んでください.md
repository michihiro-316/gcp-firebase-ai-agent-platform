# 学習ガイド - 1〜2日で理解する

このフォルダは、**GASを少し触ったことがある新卒エンジニア**が
このシステムを**1〜2日で理解して作業できる**ための勉強資料です。

---

## このシステムって何？

```
┌─────────────────────────────────────────────────────────────┐
│                    AIチャットシステム                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  できること:                                                 │
│  ・Googleアカウントでログイン                                 │
│  ・AIと会話（ChatGPTのような体験）                            │
│  ・会話履歴の保存                                            │
│  ・複数の会社で使える（マルチテナント）                        │
│                                                             │
│  使っている技術:                                             │
│  ・フロントエンド: React + TypeScript                        │
│  ・バックエンド: Python + Flask                              │
│  ・AI: Google Vertex AI (Gemini)                            │
│  ・データベース: Firestore                                   │
│  ・認証: Firebase Authentication                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 読む順番（理論学者向け：仕組みを理解してから動かす）

```
【フェーズ1: 全体像を理解する】
  02_全体像.md                   ← システムの構造を把握
  03_バックエンド解説.md          ← サーバー側の仕組み
  04_フロントエンド解説.md        ← ブラウザ側の仕組み
  05_顧客管理の仕組み.md          ← マルチテナントの仕組み

【フェーズ2: 操作方法を知る】
  06_コマンド解説.md             ← コマンドの意味を理解
  07_ファイル形式と設定ファイル.md ← 設定ファイルの役割

【フェーズ3: 実際に動かす】
  09_セットアップの流れ.md       ← 環境構築の手順
  10_動かしてみよう.md           ← ローカルで動かす
  08_AIカスタマイズ.md           ← AIの応答を変えてみる ★実験
```

> **💡 理論学者向けアプローチ**: 上記の順番で「なぜそうなっているのか」を
> 理解してから手を動かすと、トラブル時の対処がスムーズになります。
> FLOW_01〜04 は詳細なフロー解説として必要に応じて参照してください。

---

## 学習の進め方：フロー別学習

**従来の学習**と**この資料の学習**の違い：

```
【従来】ファイル単位で学ぶ
  main.py を読む → auth.py を読む → agent.py を読む
  ❌ 「で、これらがどう繋がるの？」がわからない

【この資料】フロー単位で学ぶ
  「チャットを送信したら何が起きるか」を追う
  ✅ ファイル間の繋がりがわかる！
  ✅ 「なぜこのファイルがあるのか」がわかる！
```

---

## 1〜2日 学習スケジュール（理論学者向け）

### Day 1: 仕組みを理解する（4〜6時間）

```
午前（2〜3時間）: 全体構造の把握
─────────────────────────────────────────────
│
├─→ 読む: 02_全体像.md
│   ・システム全体のアーキテクチャ図
│   ・データの流れを頭に入れる
│
├─→ 読む: 03_バックエンド解説.md
│   ・APIの仕組み
│   ・AIエージェントの動作原理
│
└─→ 読む: 04_フロントエンド解説.md
     ・Reactコンポーネントの構造
     ・状態管理の仕組み

午後（2〜3時間）: 詳細の理解
─────────────────────────────────────────────
│
├─→ 読む: 05_顧客管理の仕組み.md
│   ・マルチテナントの仕組み
│   ・Custom Claimsの役割
│
├─→ 読む: 06_コマンド解説.md
│   ・pip, npm, gcloud コマンドの意味
│
└─→ 読む: 07_ファイル形式と設定ファイル.md
     ・.ts, .tsx, package.json の役割
```

### Day 2: 実際に動かす（4〜6時間）

```
午前（2〜3時間）: 環境構築
─────────────────────────────────────────────
│
├─→ 読む・実行: 09_セットアップの流れ.md
│   やること:
│   ✅ GCPプロジェクト作成
│   ✅ Firebase設定
│   ✅ 環境変数設定
│   ✅ バックエンド起動
│   ✅ フロントエンド起動
│   ✅ ログインしてチャット ← ここまでが目標！
│
└─→ 成功の確認: ブラウザでチャットできる

午後（2〜3時間）: 動作確認と実験
─────────────────────────────────────────────
│
├─→ 実行: 10_動かしてみよう.md
│   ・各機能を実際に試す
│
├─→ 実験: 08_AIカスタマイズ.md
│   ・プロンプトを変えてみる
│   ・AIの挙動の変化を確認
│
└─→ 参照: FLOW_01〜04
     ・詳細なフローを確認したいときに
```

---

## ドキュメント一覧（番号順に読むのが推奨）

### フェーズ1: 全体像を理解する

| ファイル | 内容 |
|----------|------|
| `02_全体像.md` | システムアーキテクチャ |
| `03_バックエンド解説.md` | Python/Flask/AIの仕組み |
| `04_フロントエンド解説.md` | React/TypeScriptの仕組み |
| `05_顧客管理の仕組み.md` | マルチテナントの仕組み |

### フェーズ2: 操作方法を知る

| ファイル | 内容 |
|----------|------|
| `06_コマンド解説.md` | ターミナルコマンドの解説 |
| `07_ファイル形式と設定ファイル.md` | .ts, .json 等の役割 |

### フェーズ3: 実際に動かす

| ファイル | 内容 |
|----------|------|
| `08_AIカスタマイズ.md` | AIの応答をカスタマイズ |
| `09_セットアップの流れ.md` | 環境構築の手順 |
| `10_動かしてみよう.md` | 起動と動作確認 |

### 参考資料（詳細フロー）

| ファイル | 内容 |
|----------|------|
| `FLOW_01_チャット送信の流れ.md` | チャット処理の詳細 |
| `FLOW_02_ログインの流れ.md` | 認証処理の詳細 |
| `FLOW_04_セッション管理の流れ.md` | セッション管理の詳細 |

---

## GAS経験者向け: この技術って何？

| この資料で出てくる技術 | GASで言うと |
|----------------------|------------|
| TypeScript | GASのJavaScript（ただし型がある） |
| React | スプレッドシートのUI部分を作る仕組み |
| Python | GASのスクリプト部分（サーバー側で動く） |
| Firebase Auth | Googleアカウントでのログイン |
| Firestore | スプレッドシートの代わりのデータベース |
| Vertex AI | AIに質問する機能 |
| npm / pip | GASの「ライブラリを追加」みたいなもの |

---

## ファイル構成クイックリファレンス

### フロントエンド（ブラウザで動く部分）

```
frontend/src/
├── App.tsx ─────────── 画面の入口
├── hooks/
│   ├── useAuth.ts ──── ログイン処理
│   ├── useChat.ts ──── チャット処理
│   └── useSessions.ts ─ セッション管理（複数会話の保存）
├── components/
│   ├── ChatScreen.tsx ─ チャット画面
│   └── LoginScreen.tsx  ログイン画面
└── services/
    ├── firebase.ts ─── Firebase接続
    └── api.ts ──────── サーバーとの通信
```

### バックエンド（サーバーで動く部分）

```
backend/src/
├── main.py ─────────── APIの入口
├── common/
│   ├── auth.py ─────── 認証処理（自動振り分け対応）
│   ├── config.py ───── 設定読み込み
│   └── rate_limiter.py  レート制限
└── agents/
    ├── _base/
    │   └── firestore_checkpointer.py ── 会話履歴保存
    └── _template/
        └── agent.py ── AI処理

backend/scripts/
└── manage_customer.py ─ 顧客管理コマンド
```

---

## よくあるエラーと対処法

| エラー | 原因 | どこを見る |
|--------|------|-----------|
| CORSエラー | 設定ミス | 09_セットアップ → 環境変数 |
| 認証エラー | トークン期限切れ | 再ログイン |
| 顧客に紐付けされていません | 未登録 | 05_顧客管理 → ドメイン追加 |
| リクエスト制限を超えました | 短時間に送りすぎ | 1分待ってから再試行 |
| Module not found | 依存関係なし | `pip install` / `npm install` |
| コマンドがわからない | - | 06_コマンド解説.md |
| ファイル形式がわからない | - | 07_ファイル形式と設定ファイル.md |

---

## 学習リソース

| 種類 | 場所 | 用途 |
|------|------|------|
| Markdown | `learning/md/` | テキストで読む解説 |
| Google Colab | `learning/colab/` | 手を動かして学ぶ |
| GitHub Pages | 自動生成 | ブラウザできれいに読む |

### Google Colab の使い方

1. [Google Colab](https://colab.research.google.com/) を開く
2. 「ファイル」→「ノートブックをアップロード」
3. `learning/colab/` の `.ipynb` ファイルを選択
4. セルを上から順に実行（Shift + Enter）

---

## 学習の目標

この勉強を終えたら、以下ができるようになります：

### レベル1: 理解できる
- [ ] 「チャットを送信したら何が起きるか」を説明できる
- [ ] 各ファイルの役割を説明できる
- [ ] エラーが出た時に、どこを見ればいいかわかる

### レベル2: 修正できる
- [ ] AIのシステムプロンプトを変更できる
- [ ] 新しいユーザーを追加できる
- [ ] 環境変数を変更できる

### レベル3: 運用できる
- [ ] 新しい顧客を追加できる
- [ ] トラブルシューティングができる
- [ ] ログを見て問題を特定できる

---

## 困ったときは

1. まず該当するドキュメントを確認
2. それでも解決しない場合は、以下を伝えて質問：
   - どのファイルの何行目か
   - 何をしようとしたか
   - どんなエラーが出たか（全文）

---

さあ、**02_全体像.md** から始めましょう！（理論学者向け：まず仕組みを理解）
