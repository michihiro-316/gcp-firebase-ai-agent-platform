# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è§£èª¬

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆç”»é¢å´ï¼‰ã®ã‚³ãƒ¼ãƒ‰ã‚’è§£èª¬ã—ã¾ã™ã€‚

---

## ä½¿ã£ã¦ã„ã‚‹æŠ€è¡“

| æŠ€è¡“ | å½¹å‰² |
|------|------|
| React | UIã‚’ä½œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª |
| TypeScript | å‹ã®ã‚ã‚‹JavaScript |
| Vite | é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãƒ»ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ« |
| Firebase SDK | Firebaseé€£æº |

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
frontend/src/
â”œâ”€â”€ App.tsx           â† ãƒ¡ã‚¤ãƒ³ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ main.tsx          â† ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ hooks/            â† ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”œâ”€â”€ useAuth.ts    â† ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
â”‚   â”œâ”€â”€ useChat.ts    â† ãƒãƒ£ãƒƒãƒˆå‡¦ç†
â”‚   â””â”€â”€ useRenderer.ts â† ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼è¨­å®šèª­ã¿è¾¼ã¿
â”œâ”€â”€ services/         â† å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº
â”‚   â”œâ”€â”€ firebase.ts   â† FirebaseåˆæœŸåŒ–
â”‚   â””â”€â”€ api.ts        â† APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”œâ”€â”€ components/       â† UIãƒ‘ãƒ¼ãƒ„
â””â”€â”€ renderers/        â† ã€ä¸Šç´šè€…å‘ã‘ã€‘ãƒãƒ£ãƒƒãƒˆè¡¨ç¤ºã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
    â”œâ”€â”€ types.ts      â† å‹å®šç¾©
    â”œâ”€â”€ index.ts      â† ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼é¸æŠ
    â”œâ”€â”€ default/      â† ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼
    â””â”€â”€ _examples/    â† ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…
```

> **ğŸ’¡ åˆå­¦è€…ã¸**: `renderers/` ãƒ•ã‚©ãƒ«ãƒ€ã¯ä¸Šç´šè€…å‘ã‘ã§ã™ã€‚
> æœ€åˆã®å­¦ç¿’ã§ã¯**ã‚¹ã‚­ãƒƒãƒ—ã—ã¦OK**ã§ã™ã€‚
> ã¾ãšã¯ `App.tsx` ã¨ `hooks/` ã‚’ç†è§£ã—ã¾ã—ã‚‡ã†ã€‚

---

## é‡è¦ãªæ¦‚å¿µ

### 1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã¯ï¼Ÿ

ç”»é¢ã®ãƒ‘ãƒ¼ãƒ„ã€‚ãƒ¬ã‚´ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚ˆã†ãªã‚‚ã®ã€‚

```tsx
// ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
function MyButton() {
  return <button>ã‚¯ãƒªãƒƒã‚¯</button>;
}

// ä½¿ã†å´
function App() {
  return (
    <div>
      <MyButton />  {/* â† ã“ã“ã§ä½¿ã† */}
    </div>
  );
}
```

### 2. useState ã¨ã¯ï¼Ÿ

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ã€ŒçŠ¶æ…‹ã€ã‚’æŒã¤ãŸã‚ã®ä»•çµ„ã¿ã€‚

```tsx
function Counter() {
  // count ã¨ã„ã†çŠ¶æ…‹ã‚’ä½œã‚‹ï¼ˆåˆæœŸå€¤ 0ï¼‰
  // setCount ã§å€¤ã‚’å¤‰æ›´ã§ãã‚‹
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>ã‚«ã‚¦ãƒ³ãƒˆ: {count}</p>
      <button onClick={() => setCount(count + 1)}>
        +1
      </button>
    </div>
  );
}
```

### 3. useEffect ã¨ã¯ï¼Ÿ

ã€Œå‰¯ä½œç”¨ã€ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã€‚
ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚ŒãŸã¨ãã€æ›´æ–°ã•ã‚ŒãŸã¨ãã«å‡¦ç†ã‚’å®Ÿè¡Œã€‚

```tsx
function UserProfile() {
  const [user, setUser] = useState(null);

  // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚ŒãŸã¨ãã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
  useEffect(() => {
    fetchUser().then(data => setUser(data));
  }, []);  // [] ã¯ã€Œæœ€åˆã®1å›ã ã‘å®Ÿè¡Œã€ã®æ„å‘³

  return <div>{user?.name}</div>;
}
```

### 4. ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¨ã¯ï¼Ÿ

`use` ã§å§‹ã¾ã‚‹é–¢æ•°ã€‚ãƒ­ã‚¸ãƒƒã‚¯ã‚’å†åˆ©ç”¨ã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã€‚

```tsx
// useAuth.ts - ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã‚’ã¾ã¨ã‚ãŸã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
function useAuth() {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  const login = async () => {
    // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
  };

  const logout = async () => {
    // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
  };

  return { user, loading, login, logout };
}

// ä½¿ã†å´
function App() {
  const { user, login, logout } = useAuth();
  // ...
}
```

---

## ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã®æµã‚Œ

```tsx
// useAuth.ts ã®æ¦‚è¦

function useAuth() {
  // 1. çŠ¶æ…‹ã‚’å®šç¾©
  const [user, setUser] = useState(null);

  // 2. Firebase Authã®çŠ¶æ…‹å¤‰åŒ–ã‚’ç›£è¦–
  useEffect(() => {
    // ãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ãŸã¨ãã«å‘¼ã°ã‚Œã‚‹
    const unsubscribe = onAuthStateChanged(auth, (firebaseUser) => {
      setUser(firebaseUser);
    });

    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    return () => unsubscribe();
  }, []);

  // 3. ãƒ­ã‚°ã‚¤ãƒ³é–¢æ•°
  const login = async () => {
    const provider = new GoogleAuthProvider();
    await signInWithPopup(auth, provider);
    // â†’ æˆåŠŸã™ã‚‹ã¨ onAuthStateChanged ãŒå‘¼ã°ã‚Œã‚‹
  };

  return { user, login };
}
```

---

## ãƒãƒ£ãƒƒãƒˆå‡¦ç†ã®æµã‚Œ

```tsx
// useChat.ts ã®æ¦‚è¦

function useChat() {
  const [messages, setMessages] = useState([]);
  const { user } = useAuth();

  const sendMessage = async (text) => {
    // 1. IDãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
    const token = await user.getIdToken();

    // 2. APIã‚’å‘¼ã³å‡ºã—ï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼‰
    const response = await fetch('/chat', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ message: text }),
    });

    // 3. ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã§å—ã‘å–ã‚‹
    const reader = response.body.getReader();
    while (true) {
      const { done, value } = await reader.read();
      if (done) break;

      // å—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
      const chunk = new TextDecoder().decode(value);
      // ... ç”»é¢ã«è¡¨ç¤º
    }
  };

  return { messages, sendMessage };
}
```

---

## Server-Sent Events (SSE) ã¨ã¯ï¼Ÿ

ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã€Œå°‘ã—ãšã¤ã€ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹ä»•çµ„ã¿ã€‚

```
ã€æ™®é€šã®APIã€‘
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ â†’ ã‚µãƒ¼ãƒãƒ¼å‡¦ç†ï¼ˆ3ç§’ï¼‰â†’ å…¨éƒ¨ã¾ã¨ã‚ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹

ã€SSEã€‘
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ â†’ ã€Œã“ã‚“ã€â†’ã€Œã«ã¡ã€â†’ã€Œã¯ã€â†’ã€Œï¼ã€â†’ å®Œäº†

ãƒãƒ£ãƒƒãƒˆã®è¿”ç­”ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨ç¤ºã•ã‚Œã‚‹ï¼
```

---

## TypeScript ã®å‹

TypeScriptã§ã¯ã€Œå‹ã€ã‚’æŒ‡å®šã—ã¾ã™ã€‚
é–“é•ã„ã‚’äº‹å‰ã«é˜²ã’ã¾ã™ã€‚

```tsx
// å‹ã‚’å®šç¾©
type Message = {
  id: string;
  text: string;
  sender: 'user' | 'assistant';
  timestamp: Date;
};

// ä½¿ã†
const messages: Message[] = [];

// â†“ ã“ã‚Œã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ï¼ˆå‹ãŒé•ã†ï¼‰
// messages.push({ text: 123 });  // text ã¯ string ã®ã¯ãšï¼
```

---

## æ¬¡ã«èª­ã‚€ã¹ã

1. `frontend/src/App.tsx` - å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰
2. `frontend/src/hooks/useAuth.ts` - ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
3. `learning/04_å‹•ã‹ã—ã¦ã¿ã‚ˆã†.md` - å®Ÿéš›ã«å‹•ã‹ã™
