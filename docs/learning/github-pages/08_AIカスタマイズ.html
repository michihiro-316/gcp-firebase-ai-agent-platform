<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>08 AIカスタマイズ - GCP AI Agent 設計資料</title>
  <link rel="stylesheet" href="assets/style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📚</text></svg>">
</head>
<body>
  <header class="header">
    <a href="index.html" class="header-logo">
      <span>📚</span>
      <span>GCP AI Agent 設計資料</span>
    </a>
    <nav class="header-nav">
      <a href="index.html">ホーム</a>
      <a href="02_全体像.html">全体像</a>
      <a href="https://github.com" target="_blank">GitHub</a>
    </nav>
    <button class="menu-toggle" onclick="toggleSidebar()">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </header>

  <div class="layout">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">📖 はじめに</div>
        <ul class="sidebar-nav">
          <li><a href="01_はじめに読んでください.html" >はじめに読んでください</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">🏗️ 仕組みを理解</div>
        <ul class="sidebar-nav">
          <li><a href="02_全体像.html" >全体像</a></li>
          <li><a href="03_バックエンド解説.html" >バックエンド解説</a></li>
          <li><a href="04_フロントエンド解説.html" >フロントエンド解説</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">🛠️ セットアップ</div>
        <ul class="sidebar-nav">
          <li><a href="05_セットアップの流れ.html" >セットアップの流れ</a></li>
          <li><a href="06_コマンド解説.html" >コマンド解説</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">🚀 動かす</div>
        <ul class="sidebar-nav">
          <li><a href="07_動かしてみよう.html" >動かしてみよう</a></li>
          <li><a href="08_AIカスタマイズ.html" class="active">AIカスタマイズ</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">🔧 上級編</div>
        <ul class="sidebar-nav">
          <li><a href="10_Gatewayアーキテクチャ.html" >Gatewayアーキテクチャ</a></li>
          <li><a href="14_セキュリティとファイル連携.html" >セキュリティとファイル連携</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">🔄 参考: フロー解説</div>
        <ul class="sidebar-nav">
          <li><a href="11_チャット送信の流れ.html" >チャット送信の流れ</a></li>
          <li><a href="12_ログインの流れ.html" >ログインの流れ</a></li>
          <li><a href="13_セッション管理の流れ.html" >セッション管理の流れ</a></li>
        </ul>
      </div>
    </aside>

    <main class="main">
      <article class="content">
        <h1 id="aiカスタマイズ">AIカスタマイズ<a class="header-link" href="#aiカスタマイズ" title="Permanent link">&para;</a></h1>
<div class="chapter-hero">
<span class="emoji">🎨</span>
<h1>AIカスタマイズ</h1>
<p class="subtitle">「AIの性格を変えてみよう！」<br>「プロンプトを変えるだけで全然違う応答になる」</p>
</div>

<hr />
<h2 id="この章で学ぶこと">この章で学ぶこと<a class="header-link" href="#この章で学ぶこと" title="Permanent link">&para;</a></h2>
<div class="goal-box">
<h3>📚 学習目標</h3>
<ol>
<li>SYSTEM_PROMPT の変更方法</li>
<li>AIの性格・役割のカスタマイズ</li>
<li>顧客別AIの作成</li>
<li>パラメータ調整（モデル、温度など）</li>
</ol>
<p><strong>⏱️ 想定学習時間: 15分</strong></p>
</div>

<hr />
<h2 id="基本-system_prompt-を変更する">基本: SYSTEM_PROMPT を変更する<a class="header-link" href="#基本-system_prompt-を変更する" title="Permanent link">&para;</a></h2>
<p>AIの性格・役割は <code>SYSTEM_PROMPT</code> で決まります。</p>
<h3 id="ファイルの場所">ファイルの場所<a class="header-link" href="#ファイルの場所" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code>src/backend/src/agents/_template/agent.py
</code></pre>

<h3 id="変更箇所">変更箇所<a class="header-link" href="#変更箇所" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-python"># =============================================
# ここを編集してAIをカスタマイズ
# =============================================

SYSTEM_PROMPT = &quot;&quot;&quot;あなたは親切で丁寧なAIアシスタントです。
ユーザーの質問に対して、わかりやすく簡潔に回答してください。
日本語で回答してください。&quot;&quot;&quot;
</code></pre>

<div class="tip-box">
<h3>💡 SYSTEM_PROMPT とは？</h3>
<p>AIに「あなたはこういう役割です」と教える指示文</p>
<p><strong>【人間に例えると】</strong><br>
「あなたは今日からカスタマーサポートとして働きます。<br>
お客様には丁寧に、わかりやすく説明してください。」<br>
と伝えるようなもの</p>
<p><strong>SYSTEM_PROMPT を変えると、AIの応答スタイルが変わる！</strong></p>
</div>

<hr />
<h2 id="実験してみよう">実験してみよう<a class="header-link" href="#実験してみよう" title="Permanent link">&para;</a></h2>
<h3 id="実験1-関西弁aiに変える">実験1: 関西弁AIに変える<a class="header-link" href="#実験1-関西弁aiに変える" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-python">SYSTEM_PROMPT = &quot;&quot;&quot;あなたは関西弁で話すAIアシスタントやで。
ユーザーの質問にフレンドリーに答えてや。
「やで」「やん」「なんでやねん」などを使ってな。&quot;&quot;&quot;
</code></pre>

<p><strong>結果例:</strong></p>
<pre class="codehilite"><code>ユーザー: こんにちは
AI: おお、こんにちは〜！元気にしとる？なんか聞きたいことあったら言うてな！
</code></pre>

<hr />
<h3 id="実験2-専門家aiに変える">実験2: 専門家AIに変える<a class="header-link" href="#実験2-専門家aiに変える" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-python">SYSTEM_PROMPT = &quot;&quot;&quot;あなたはPythonプログラミングの専門家です。
コードの書き方、デバッグ方法、ベストプラクティスを教えてください。
初心者にも分かりやすく説明してください。
コード例は必ず含めてください。&quot;&quot;&quot;
</code></pre>

<p><strong>結果例:</strong></p>
<pre class="codehilite"><code>ユーザー: リストの使い方を教えて
AI: Pythonのリストについて説明しますね！

リストは複数の値をまとめて格納できるデータ構造です。

# リストの作成
fruits = [&quot;りんご&quot;, &quot;みかん&quot;, &quot;バナナ&quot;]

# 要素の追加
fruits.append(&quot;ぶどう&quot;)

# 要素の取得
print(fruits[0])  # &quot;りんご&quot;
...
</code></pre>

<hr />
<h3 id="実験3-キャラクターaiに変える">実験3: キャラクターAIに変える<a class="header-link" href="#実験3-キャラクターaiに変える" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-python">SYSTEM_PROMPT = &quot;&quot;&quot;あなたは「AIくん」という名前のAIキャラクターです。
一人称は「ボク」で、語尾に「〜だよ」「〜なんだ」をつけて話します。
明るく元気な性格で、ユーザーを励まします。
絵文字を適度に使ってください。&quot;&quot;&quot;
</code></pre>

<p><strong>結果例:</strong></p>
<pre class="codehilite"><code>ユーザー: 疲れた
AI: 疲れちゃったんだね 😢 でも大丈夫だよ！
ボクが応援してるから、少し休んでまた頑張ろう！💪✨
何かボクにできることがあったら言ってね！
</code></pre>

<hr />
<h2 id="変更を確認する手順">変更を確認する手順<a class="header-link" href="#変更を確認する手順" title="Permanent link">&para;</a></h2>
<h3 id="1-agentpy-を編集">1. agent.py を編集<a class="header-link" href="#1-agentpy-を編集" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-bash"># VSCode で開く
code src/backend/src/agents/_template/agent.py

# または vim で開く
vim src/backend/src/agents/_template/agent.py
</code></pre>

<h3 id="2-バックエンドを再起動">2. バックエンドを再起動<a class="header-link" href="#2-バックエンドを再起動" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-bash">cd src/backend
# Ctrl+C で停止してから再起動
functions-framework --target=main --port=8080
</code></pre>

<h3 id="3-ブラウザでチャット">3. ブラウザでチャット<a class="header-link" href="#3-ブラウザでチャット" title="Permanent link">&para;</a></h3>
<p>http://localhost:5173/ でチャットして確認</p>
<div class="warning-box">
<h3>⚠️ 重要な注意</h3>
<p><strong>プロンプトを変更したら必ず再起動が必要！</strong></p>
<p>Python のコードを変更しても、サーバーを再起動しないと反映されない<br>
（フロントエンドはホットリロードで自動反映されるけど、バックエンドは違う）</p>
</div>

<hr />
<h2 id="顧客別にカスタマイズする場合">顧客別にカスタマイズする場合<a class="header-link" href="#顧客別にカスタマイズする場合" title="Permanent link">&para;</a></h2>
<h3 id="1-テンプレートをコピー">1. テンプレートをコピー<a class="header-link" href="#1-テンプレートをコピー" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-bash">cd src/backend/src/agents
cp -r _template acme-corp
</code></pre>

<h3 id="2-agentpy-を編集">2. agent.py を編集<a class="header-link" href="#2-agentpy-を編集" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-python"># src/backend/src/agents/acme-corp/agent.py

class AcmeCorpAgent(BaseAgent):
    SYSTEM_PROMPT = &quot;&quot;&quot;あなたはACME社の専門AIアシスタントです。
ACME社の製品・サービスに関する質問に答えてください。
丁寧な言葉遣いで、正確な情報を提供してください。&quot;&quot;&quot;
</code></pre>

<h3 id="3-mainpy-に登録">3. main.py に登録<a class="header-link" href="#3-mainpy-に登録" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-python">from agents.acme_corp.agent import AcmeCorpAgent

AGENTS = {
    &quot;template&quot;: TemplateAgent,
    &quot;acme-corp&quot;: AcmeCorpAgent,  # 追加
}
</code></pre>

<h3 id="4-設定ファイルを作成">4. 設定ファイルを作成<a class="header-link" href="#4-設定ファイルを作成" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-bash">cp customer-configs/template.env customer-configs/acme-corp.env
</code></pre>

<pre class="codehilite"><code class="language-env">CUSTOMER_ID=acme-corp
DEFAULT_AGENT=acme-corp
</code></pre>

<div class="tip-box">
<h3>🏢 顧客別カスタマイズの使いどころ</h3>
<ul>
<li>A社: 製品サポート特化のAI</li>
<li>B社: 社内FAQ特化のAI</li>
<li>C社: 営業支援特化のAI</li>
</ul>
<p><strong>同じシステムで、顧客ごとに違うAIを提供できる！</strong></p>
</div>

<hr />
<h2 id="その他のカスタマイズ">その他のカスタマイズ<a class="header-link" href="#その他のカスタマイズ" title="Permanent link">&para;</a></h2>
<h3 id="モデルを変更">モデルを変更<a class="header-link" href="#モデルを変更" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-python"># より高性能なモデルを使う（コストは上がる）
MODEL_NAME = &quot;gemini-1.5-pro&quot;

# 高速だが簡易なモデル（コストは下がる）
MODEL_NAME = &quot;gemini-1.5-flash&quot;
</code></pre>

<h3 id="会話履歴の量を変更">会話履歴の量を変更<a class="header-link" href="#会話履歴の量を変更" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-python"># より長い会話を記憶する（コストは上がる）
MAX_HISTORY_MESSAGES = 40  # 約20往復分

# 短い会話（コストは下がる）
MAX_HISTORY_MESSAGES = 10  # 約5往復分
</code></pre>

<h3 id="応答の創造性を変更">応答の創造性を変更<a class="header-link" href="#応答の創造性を変更" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-python"># temperature を変更
self.llm = ChatVertexAI(
    model=self.MODEL_NAME,
    temperature=0.3,  # 低い = 一貫した応答、高い = 創造的な応答
    ...
)
</code></pre>

<div class="info-box">
<h3>🌡️ temperature とは？</h3>
<pre>
 0.0 ────────────────────────────────────────────────────────── 1.0
 │                                                               │
 ▼                                                               ▼
一貫性重視                                                    創造性重視
・同じ質問に同じ回答                                          ・多様な回答
・事実確認向き                                                ・発想力重視
・FAQ、カスタマーサポート                                      ・創作、ブレスト
</pre>
<p><strong>【おすすめ値】</strong></p>
<ul>
<li>カスタマーサポート: 0.2〜0.4</li>
<li>一般的な会話: 0.5〜0.7</li>
<li>クリエイティブ作業: 0.8〜1.0</li>
</ul>
</div>

<hr />
<h2 id="効果的なプロンプトの書き方">効果的なプロンプトの書き方<a class="header-link" href="#効果的なプロンプトの書き方" title="Permanent link">&para;</a></h2>
<h3 id="良いプロンプトの例">良いプロンプトの例<a class="header-link" href="#良いプロンプトの例" title="Permanent link">&para;</a></h3>
<pre class="codehilite"><code class="language-python">SYSTEM_PROMPT = &quot;&quot;&quot;あなたは株式会社ABCのカスタマーサポートAIです。

【役割】
- お客様からの問い合わせに丁寧に回答する
- 製品の使い方、トラブルシューティングを支援する

【話し方】
- 敬語を使う
- 簡潔に、わかりやすく説明する
- 箇条書きを活用する

【注意事項】
- 価格や契約に関する質問は「営業担当にお問い合わせください」と案内する
- 技術的に難しい質問は「サポートチームに転送します」と案内する
- わからないことは「わからない」と正直に伝える

【禁止事項】
- 競合他社の悪口を言わない
- 根拠のない情報を伝えない
&quot;&quot;&quot;
</code></pre>

<h3 id="ポイント">ポイント<a class="header-link" href="#ポイント" title="Permanent link">&para;</a></h3>
<div class="tip-box">
<h3>✍️ 効果的なプロンプトのコツ</h3>
<ol>
<li><strong>役割を明確に</strong><br>「あなたは〇〇です」と具体的に伝える</li>
<li><strong>話し方を指定</strong><br>敬語、カジュアル、専門用語の使用など</li>
<li><strong>できること・できないことを明示</strong><br>「〇〇の質問には対応できない」など</li>
<li><strong>具体例を入れる</strong><br>「例えば〇〇と聞かれたら△△と答える」</li>
<li><strong>禁止事項を明記</strong><br>「〇〇してはいけない」と明示的に書く</li>
</ol>
</div>

<hr />
<h2 id="注意事項">注意事項<a class="header-link" href="#注意事項" title="Permanent link">&para;</a></h2>
<ul>
<li>プロンプトを変更したら必ず再起動が必要</li>
<li>本番環境に反映するにはデプロイが必要</li>
<li>モデル変更はコストに影響する</li>
<li>プロンプトが長すぎると処理が遅くなる</li>
</ul>
<hr />
<h2 id="まとめ">まとめ<a class="header-link" href="#まとめ" title="Permanent link">&para;</a></h2>
<div class="summary-box">
<h3>🎓 この章で学んだこと</h3>
<ul>
<li>✅ SYSTEM_PROMPT でAIの性格・役割を変更できる</li>
<li>✅ 顧客別にカスタマイズしたAIを作成できる</li>
<li>✅ temperature で応答の創造性を調整できる</li>
<li>✅ 効果的なプロンプトの書き方</li>
</ul>
<p><strong>これで1日の学習は完了です！お疲れ様でした！</strong></p>
</div>

<hr />
<h2 id="次のステップ発展編">次のステップ（発展編）<a class="header-link" href="#次のステップ発展編" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>内容</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ツールの追加</td>
<td>AIに計算や検索の能力を追加</td>
</tr>
<tr>
<td>条件分岐</td>
<td>質問内容によって処理を分ける</td>
</tr>
<tr>
<td>外部API連携</td>
<td>天気予報や株価などの情報を取得</td>
</tr>
</tbody>
</table>
<p>より複雑なエージェントについては LangGraph のドキュメントを参照:<br />
https://langchain-ai.github.io/langgraph/</p>
      </article>
      <footer class="footer">
        GCP AI Agent 設計資料 | Built with Python & Markdown
      </footer>
    </main>
  </div>

  <script>
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
    }

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', function(e) {
      const sidebar = document.getElementById('sidebar');
      const toggle = document.querySelector('.menu-toggle');
      if (!sidebar.contains(e.target) && !toggle.contains(e.target)) {
        sidebar.classList.remove('open');
      }
    });
  </script>
</body>
</html>