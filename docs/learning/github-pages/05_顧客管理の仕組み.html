<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>05 é¡§å®¢ç®¡ç†ã®ä»•çµ„ã¿ - GCP AI Agent Platform å­¦ç¿’ã‚¬ã‚¤ãƒ‰</title>
  <link rel="stylesheet" href="assets/style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“š</text></svg>">
</head>
<body>
  <header class="header">
    <a href="index.html" class="header-logo">
      <span>ğŸ“š</span>
      <span>GCP AI Agent å­¦ç¿’ã‚¬ã‚¤ãƒ‰</span>
    </a>
    <nav class="header-nav">
      <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
      <a href="FLOW_03_ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®æµã‚Œ.html">ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</a>
      <a href="https://github.com" target="_blank">GitHub</a>
    </nav>
    <button class="menu-toggle" onclick="toggleSidebar()">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </header>

  <div class="layout">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">ğŸš€ ã¯ã˜ã‚ã«</div>
        <ul class="sidebar-nav">
          <li><a href="00_ã¯ã˜ã‚ã«èª­ã‚“ã§ãã ã•ã„.html" >ã¯ã˜ã‚ã«èª­ã‚“ã§ãã ã•ã„</a></li>
          <li><a href="04_å‹•ã‹ã—ã¦ã¿ã‚ˆã†.html" >å‹•ã‹ã—ã¦ã¿ã‚ˆã†</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">ğŸ“– åŸºç¤çŸ¥è­˜</div>
        <ul class="sidebar-nav">
          <li><a href="01_å…¨ä½“åƒ.html" >å…¨ä½“åƒ</a></li>
          <li><a href="02_ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è§£èª¬.html" >ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è§£èª¬</a></li>
          <li><a href="03_ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è§£èª¬.html" >ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è§£èª¬</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">ğŸ”„ ãƒ•ãƒ­ãƒ¼è§£èª¬</div>
        <ul class="sidebar-nav">
          <li><a href="FLOW_01_ãƒãƒ£ãƒƒãƒˆé€ä¿¡ã®æµã‚Œ.html" >ãƒãƒ£ãƒƒãƒˆé€ä¿¡ã®æµã‚Œ</a></li>
          <li><a href="FLOW_02_ãƒ­ã‚°ã‚¤ãƒ³ã®æµã‚Œ.html" >ãƒ­ã‚°ã‚¤ãƒ³ã®æµã‚Œ</a></li>
          <li><a href="FLOW_03_ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®æµã‚Œ.html" >ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®æµã‚Œ</a></li>
          <li><a href="FLOW_04_ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®æµã‚Œ.html" >ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®æµã‚Œ</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">ğŸ”§ ä¸Šç´šç·¨</div>
        <ul class="sidebar-nav">
          <li><a href="05_é¡§å®¢ç®¡ç†ã®ä»•çµ„ã¿.html" class="active">é¡§å®¢ç®¡ç†ã®ä»•çµ„ã¿</a></li>
          <li><a href="08_AIã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º.html" >AIã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">ğŸ“š ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹</div>
        <ul class="sidebar-nav">
          <li><a href="06_ã‚³ãƒãƒ³ãƒ‰è§£èª¬.html" >ã‚³ãƒãƒ³ãƒ‰è§£èª¬</a></li>
          <li><a href="07_ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«.html" >ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã¨è¨­å®š</a></li>
        </ul>
      </div>
    </aside>

    <main class="main">
      <article class="content">
        <h1 id="é¡§å®¢ç®¡ç†ã®ä»•çµ„ã¿">é¡§å®¢ç®¡ç†ã®ä»•çµ„ã¿<a class="header-link" href="#é¡§å®¢ç®¡ç†ã®ä»•çµ„ã¿" title="Permanent link">&para;</a></h1>
<p>è¤‡æ•°ã®é¡§å®¢ï¼ˆä¼šç¤¾ï¼‰ã«ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã™ã‚‹ä»•çµ„ã¿ã‚’è§£èª¬ã—ã¾ã™ã€‚</p>
<hr />
<h2 id="é¡§å®¢ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é•ã„">é¡§å®¢ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é•ã„<a class="header-link" href="#é¡§å®¢ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é•ã„" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code>é¡§å®¢ï¼ˆCustomerï¼‰= ä¼šç¤¾
  â”œâ”€â”€ ãƒ¦ãƒ¼ã‚¶ãƒ¼Aï¼ˆå±±ç”°ã•ã‚“ï¼‰
  â”œâ”€â”€ ãƒ¦ãƒ¼ã‚¶ãƒ¼Bï¼ˆç”°ä¸­ã•ã‚“ï¼‰
  â””â”€â”€ ãƒ¦ãƒ¼ã‚¶ãƒ¼Cï¼ˆä½è—¤ã•ã‚“ï¼‰
</code></pre></div>

<table>
<thead>
<tr>
<th>æ¦‚å¿µ</th>
<th>ä¾‹</th>
<th>èª¬æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>é¡§å®¢</td>
<td>æ ªå¼ä¼šç¤¾ACME</td>
<td>ã‚µãƒ¼ãƒ“ã‚¹ã‚’å¥‘ç´„ã—ã¦ã„ã‚‹ä¼šç¤¾</td>
</tr>
<tr>
<td>ãƒ¦ãƒ¼ã‚¶ãƒ¼</td>
<td>yamada@acme.co.jp</td>
<td>å®Ÿéš›ã«ä½¿ã†äºº</td>
</tr>
<tr>
<td>é¡§å®¢ID</td>
<td>acme-corp</td>
<td>ã‚·ã‚¹ãƒ†ãƒ ä¸Šã®è­˜åˆ¥å­</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="ãƒ‡ãƒ¼ã‚¿ã®åˆ†é›¢">ãƒ‡ãƒ¼ã‚¿ã®åˆ†é›¢<a class="header-link" href="#ãƒ‡ãƒ¼ã‚¿ã®åˆ†é›¢" title="Permanent link">&para;</a></h2>
<h3 id="ãªãœåˆ†é›¢ãŒå¿…è¦">ãªãœåˆ†é›¢ãŒå¿…è¦ï¼Ÿ<a class="header-link" href="#ãªãœåˆ†é›¢ãŒå¿…è¦" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>Aç¤¾ã®ç¤¾å“¡ãŒBç¤¾ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚ŒãŸã‚‰å¤§å•é¡Œï¼
â†’ é¡§å®¢ã”ã¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã«åˆ†é›¢ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
</code></pre></div>

<h3 id="ã©ã†ã‚„ã£ã¦åˆ†é›¢ã—ã¦ã„ã‚‹">ã©ã†ã‚„ã£ã¦åˆ†é›¢ã—ã¦ã„ã‚‹ï¼Ÿ<a class="header-link" href="#ã©ã†ã‚„ã£ã¦åˆ†é›¢ã—ã¦ã„ã‚‹" title="Permanent link">&para;</a></h3>
<p>Firestoreã®éšå±¤æ§‹é€ ã§åˆ†é›¢:</p>
<div class="codehilite"><pre><span></span><code>customers/
â”œâ”€â”€ acme-corp/                 â† Aç¤¾ã®ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ name: &quot;æ ªå¼ä¼šç¤¾ACME&quot;
â”‚   â””â”€â”€ checkpoints/
â”‚       â”œâ”€â”€ user1_abc123/      â† Aç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¼šè©±
â”‚       â””â”€â”€ user2_def456/
â”‚
â”œâ”€â”€ beta-inc/                  â† Bç¤¾ã®ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ name: &quot;ãƒ™ãƒ¼ã‚¿æ ªå¼ä¼šç¤¾&quot;
â”‚   â””â”€â”€ checkpoints/
â”‚       â””â”€â”€ user3_ghi789/      â† Bç¤¾ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¼šè©±
</code></pre></div>

<p>Aç¤¾ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ <code>customers/acme-corp/</code> ä»¥ä¸‹ã«ã—ã‹ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã€‚</p>
<hr />
<h2 id="custom-claims-ã¨ã¯">Custom Claims ã¨ã¯ï¼Ÿ<a class="header-link" href="#custom-claims-ã¨ã¯" title="Permanent link">&para;</a></h2>
<p>Firebase Authã®ã€Œã‚«ã‚¹ã‚¿ãƒ å±æ€§ã€æ©Ÿèƒ½ã€‚</p>
<h3 id="ã‚¤ãƒ¡ãƒ¼ã‚¸">ã‚¤ãƒ¡ãƒ¼ã‚¸<a class="header-link" href="#ã‚¤ãƒ¡ãƒ¼ã‚¸" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="err">ã€</span><span class="n">æ™®é€šã®ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±</span><span class="err">ã€‘</span>
<span class="o">-</span><span class="w"> </span><span class="nl">uid</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;abc123&quot;</span>
<span class="o">-</span><span class="w"> </span><span class="nl">email</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;yamada@acme.co.jp&quot;</span>
<span class="o">-</span><span class="w"> </span><span class="nl">displayName</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;å±±ç”°å¤ªéƒ&quot;</span>

<span class="err">ã€</span><span class="n">Custom</span><span class="w"> </span><span class="n">Claims</span><span class="w"> </span><span class="n">ã‚’è¿½åŠ </span><span class="err">ã€‘</span>
<span class="o">-</span><span class="w"> </span><span class="nl">uid</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;abc123&quot;</span>
<span class="o">-</span><span class="w"> </span><span class="nl">email</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;yamada@acme.co.jp&quot;</span>
<span class="o">-</span><span class="w"> </span><span class="nl">displayName</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;å±±ç”°å¤ªéƒ&quot;</span>
<span class="o">-</span><span class="w"> </span><span class="nl">customer_id</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;acme-corp&quot;</span><span class="w">  </span><span class="err">â†</span><span class="w"> </span><span class="n">ã“ã‚Œ</span><span class="err">ï¼</span>
</code></pre></div>

<h3 id="ãªãœ-custom-claims-ã‚’ä½¿ã†">ãªãœ Custom Claims ã‚’ä½¿ã†ï¼Ÿ<a class="header-link" href="#ãªãœ-custom-claims-ã‚’ä½¿ã†" title="Permanent link">&para;</a></h3>
<ol>
<li>IDãƒˆãƒ¼ã‚¯ãƒ³ã«å«ã¾ã‚Œã‚‹ â†’ APIå‘¼ã³å‡ºã—ã®ãŸã³ã«å–å¾—ä¸è¦</li>
<li>Firebase ãŒç®¡ç† â†’ å®‰å…¨</li>
<li>ã‚µãƒ¼ãƒãƒ¼å´ã§ã—ã‹è¨­å®šã§ããªã„ â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ”¹ã–ã‚“ã§ããªã„</li>
</ol>
<hr />
<h2 id="é¡§å®¢ç®¡ç†ã®æ“ä½œ">é¡§å®¢ç®¡ç†ã®æ“ä½œ<a class="header-link" href="#é¡§å®¢ç®¡ç†ã®æ“ä½œ" title="Permanent link">&para;</a></h2>
<h3 id="ç®¡ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ">ç®¡ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ<a class="header-link" href="#ç®¡ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>backend

<span class="c1"># é¡§å®¢ä¸€è¦§ã‚’è¦‹ã‚‹</span>
python<span class="w"> </span>scripts/manage_customer.py<span class="w"> </span>list

<span class="c1"># æ–°ã—ã„é¡§å®¢ã‚’è¿½åŠ </span>
python<span class="w"> </span>scripts/manage_customer.py<span class="w"> </span>add<span class="w"> </span>test-corp<span class="w"> </span><span class="s2">&quot;æ ªå¼ä¼šç¤¾ãƒ†ã‚¹ãƒˆ&quot;</span>

<span class="c1"># ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¡§å®¢ã«ç´ä»˜ã‘</span>
python<span class="w"> </span>scripts/manage_customer.py<span class="w"> </span>add-user<span class="w"> </span>test-corp<span class="w"> </span>yamada@test.co.jp

<span class="c1"># é¡§å®¢ã®è©³ç´°ã‚’è¦‹ã‚‹</span>
python<span class="w"> </span>scripts/manage_customer.py<span class="w"> </span>show<span class="w"> </span>test-corp

<span class="c1"># ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è©³ç´°ã‚’è¦‹ã‚‹</span>
python<span class="w"> </span>scripts/manage_customer.py<span class="w"> </span>show-user<span class="w"> </span>yamada@test.co.jp
</code></pre></div>

<h3 id="ç´ä»˜ã‘ã®æµã‚Œ">ç´ä»˜ã‘ã®æµã‚Œ<a class="header-link" href="#ç´ä»˜ã‘ã®æµã‚Œ" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">é¡§å®¢ã‚’ä½œæˆ</span>
<span class="w">   </span><span class="n">python</span><span class="w"> </span><span class="n">scripts</span><span class="o">/</span><span class="n">manage_customer</span><span class="mf">.</span><span class="n">py</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">acme</span><span class="o">-</span><span class="n">corp</span><span class="w"> </span><span class="s">&quot;æ ªå¼ä¼šç¤¾ACME&quot;</span>

<span class="w">   </span><span class="n">Firestore</span><span class="p">:</span>
<span class="w">   </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">customers</span><span class="o">/</span><span class="n">acme</span><span class="o">-</span><span class="n">corp</span><span class="o">/</span>
<span class="w">       </span><span class="err">â””â”€â”€</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;æ ªå¼ä¼šç¤¾ACME&quot;</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒGoogleãƒ­ã‚°ã‚¤ãƒ³</span>
<span class="w">   </span><span class="err">ï¼ˆ</span><span class="n">ã¾ã </span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="n">ã¯æœªè¨­å®š</span><span class="err">ï¼‰</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¡§å®¢ã«ç´ä»˜ã‘</span>
<span class="w">   </span><span class="n">python</span><span class="w"> </span><span class="n">scripts</span><span class="o">/</span><span class="n">manage_customer</span><span class="mf">.</span><span class="n">py</span><span class="w"> </span><span class="n">add</span><span class="o">-</span><span class="n">user</span><span class="w"> </span><span class="n">acme</span><span class="o">-</span><span class="n">corp</span><span class="w"> </span><span class="n">yamada</span><span class="err">@</span><span class="n">acme</span><span class="mf">.</span><span class="n">co</span><span class="mf">.</span><span class="n">jp</span>

<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Firebase</span><span class="w"> </span><span class="n">Auth</span><span class="w"> </span><span class="n">ã®</span><span class="w"> </span><span class="n">Custom</span><span class="w"> </span><span class="n">Claims</span><span class="w"> </span><span class="n">ã«</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="n">ã‚’è¨­å®š</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Firestore</span><span class="w"> </span><span class="n">ã«ã‚‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä¿å­˜</span>

<span class="mf">4.</span><span class="w"> </span><span class="n">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå†ãƒ­ã‚°ã‚¤ãƒ³</span>
<span class="w">   </span><span class="err">ï¼ˆ</span><span class="n">æ–°ã—ã„IDãƒˆãƒ¼ã‚¯ãƒ³ã«</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="n">ãŒå«ã¾ã‚Œã‚‹</span><span class="err">ï¼‰</span>

<span class="mf">5.</span><span class="w"> </span><span class="n">APIã‚’å‘¼ã³å‡ºã™ã¨</span><span class="mf">...</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒ</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="n">ã‚’å–å¾—</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">å¯¾å¿œã™ã‚‹é¡§å®¢ã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹</span>
</code></pre></div>

<hr />
<h2 id="ã‚³ãƒ¼ãƒ‰ã®è§£èª¬">ã‚³ãƒ¼ãƒ‰ã®è§£èª¬<a class="header-link" href="#ã‚³ãƒ¼ãƒ‰ã®è§£èª¬" title="Permanent link">&para;</a></h2>
<h3 id="authpy">auth.py<a class="header-link" href="#authpy" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_user_customer_id</span><span class="p">(</span><span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom Claims ã‹ã‚‰ customer_id ã‚’å–å¾—</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>           <span class="c1"># Firebase Auth ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—</span>
    <span class="n">claims</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">custom_claims</span> <span class="ow">or</span> <span class="p">{}</span>    <span class="c1"># Custom Claims ã‚’å–å¾—</span>
    <span class="k">return</span> <span class="n">claims</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;customer_id&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span>  <span class="c1"># customer_id ã‚’è¿”ã™</span>
</code></pre></div>

<h3 id="firestore_checkpointerpy">firestore_checkpointer.py<a class="header-link" href="#firestore_checkpointerpy" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_checkpoint_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thread_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    é¡§å®¢åˆ¥ã®ãƒ‘ã‚¹ã‚’ç”Ÿæˆ</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="s2">&quot;customers&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">document</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">customer_id</span><span class="p">)</span>      <span class="c1"># â† é¡§å®¢ID</span>
        <span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="s2">&quot;checkpoints&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">document</span><span class="p">(</span><span class="n">thread_id</span><span class="p">)</span>
        <span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="s2">&quot;checkpoints&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># â†’ customers/{customer_id}/checkpoints/{thread_id}/checkpoints/</span>
</code></pre></div>

<hr />
<h2 id="æ³¨æ„äº‹é …">æ³¨æ„äº‹é …<a class="header-link" href="#æ³¨æ„äº‹é …" title="Permanent link">&para;</a></h2>
<h3 id="1-å†ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦">1. å†ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦<a class="header-link" href="#1-å†ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦" title="Permanent link">&para;</a></h3>
<p>Custom Claims ã‚’è¨­å®šã—ãŸå¾Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å†ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã€‚<br />
IDãƒˆãƒ¼ã‚¯ãƒ³ã¯ç™ºè¡Œæ™‚ã®æƒ…å ±ã‚’æŒã£ã¦ã„ã‚‹ãŸã‚ã€‚</p>
<h3 id="2-1ãƒ¦ãƒ¼ã‚¶ãƒ¼--1é¡§å®¢">2. 1ãƒ¦ãƒ¼ã‚¶ãƒ¼ = 1é¡§å®¢<a class="header-link" href="#2-1ãƒ¦ãƒ¼ã‚¶ãƒ¼--1é¡§å®¢" title="Permanent link">&para;</a></h3>
<p>ç¾åœ¨ã®è¨­è¨ˆã§ã¯ã€1äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯1ã¤ã®é¡§å®¢ã«ã—ã‹æ‰€å±ã§ããªã„ã€‚<br />
è¤‡æ•°é¡§å®¢ã«æ‰€å±ã•ã›ãŸã„å ´åˆã¯è¨­è¨ˆå¤‰æ›´ãŒå¿…è¦ã€‚</p>
<h3 id="3-ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¡§å®¢">3. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¡§å®¢<a class="header-link" href="#3-ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¡§å®¢" title="Permanent link">&para;</a></h3>
<p>customer_id ãŒæœªè¨­å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€Œdefaultã€é¡§å®¢ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ã€‚<br />
æœ¬ç•ªã§ã¯ default ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã€‚</p>
<hr />
<h2 id="firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã®ç¢ºèª">Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã®ç¢ºèª<a class="header-link" href="#firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã®ç¢ºèª" title="Permanent link">&para;</a></h2>
<h3 id="custom-claims-ã‚’ç¢ºèª">Custom Claims ã‚’ç¢ºèª<a class="header-link" href="#custom-claims-ã‚’ç¢ºèª" title="Permanent link">&para;</a></h3>
<p>Firebase Console â†’ Authentication â†’ Users<br />
â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ ã‚«ã‚¹ã‚¿ãƒ  ã‚¯ãƒ¬ãƒ¼ãƒ </p>
<h3 id="firestoreã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª">Firestoreã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª<a class="header-link" href="#firestoreã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª" title="Permanent link">&para;</a></h3>
<p>Firebase Console â†’ Firestore Database<br />
â†’ customers ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’å±•é–‹</p>
<hr />
<h2 id="ã¾ã¨ã‚">ã¾ã¨ã‚<a class="header-link" href="#ã¾ã¨ã‚" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code>ã€é¡§å®¢è¿½åŠ ã®æµã‚Œã€‘

1. manage_customer.py add ã§Firestoreã«é¡§å®¢ã‚’ä½œæˆ

2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«Googleãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚‚ã‚‰ã†

3. manage_customer.py add-user ã§ç´ä»˜ã‘
   <span class="k">-</span> Custom Claims ã« customer_id ã‚’è¨­å®š
   <span class="k">-</span> Firestore ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å†ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚‚ã‚‰ã†

5. å®Œäº†ï¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯é¡§å®¢åˆ¥ã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹
</code></pre></div>
      </article>
      <footer class="footer">
        GCP AI Agent Platform å­¦ç¿’ã‚¬ã‚¤ãƒ‰ | Built with Python & Markdown
      </footer>
    </main>
  </div>

  <script>
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
    }

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', function(e) {
      const sidebar = document.getElementById('sidebar');
      const toggle = document.querySelector('.menu-toggle');
      if (!sidebar.contains(e.target) && !toggle.contains(e.target)) {
        sidebar.classList.remove('open');
      }
    });
  </script>
</body>
</html>