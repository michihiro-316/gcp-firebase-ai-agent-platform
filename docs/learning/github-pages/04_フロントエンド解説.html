<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>04 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è§£èª¬ - GCP AI Agent è¨­è¨ˆè³‡æ–™</title>
  <link rel="stylesheet" href="assets/style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“š</text></svg>">
</head>
<body>
  <header class="header">
    <a href="index.html" class="header-logo">
      <span>ğŸ“š</span>
      <span>GCP AI Agent è¨­è¨ˆè³‡æ–™</span>
    </a>
    <nav class="header-nav">
      <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
      <a href="02_å…¨ä½“åƒ.html">å…¨ä½“åƒ</a>
      <a href="https://github.com" target="_blank">GitHub</a>
    </nav>
    <button class="menu-toggle" onclick="toggleSidebar()">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </header>

  <div class="layout">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">ğŸ“– ã¯ã˜ã‚ã«</div>
        <ul class="sidebar-nav">
          <li><a href="01_ã¯ã˜ã‚ã«èª­ã‚“ã§ãã ã•ã„.html" >ã¯ã˜ã‚ã«èª­ã‚“ã§ãã ã•ã„</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">ğŸ—ï¸ ä»•çµ„ã¿ã‚’ç†è§£</div>
        <ul class="sidebar-nav">
          <li><a href="02_å…¨ä½“åƒ.html" >å…¨ä½“åƒ</a></li>
          <li><a href="03_ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è§£èª¬.html" >ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è§£èª¬</a></li>
          <li><a href="04_ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è§£èª¬.html" class="active">ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è§£èª¬</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">ğŸ› ï¸ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</div>
        <ul class="sidebar-nav">
          <li><a href="05_ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®æµã‚Œ.html" >ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®æµã‚Œ</a></li>
          <li><a href="06_ã‚³ãƒãƒ³ãƒ‰è§£èª¬.html" >ã‚³ãƒãƒ³ãƒ‰è§£èª¬</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">ğŸš€ å‹•ã‹ã™</div>
        <ul class="sidebar-nav">
          <li><a href="07_å‹•ã‹ã—ã¦ã¿ã‚ˆã†.html" >å‹•ã‹ã—ã¦ã¿ã‚ˆã†</a></li>
          <li><a href="08_AIã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º.html" >AIã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">ğŸ”§ ä¸Šç´šç·¨</div>
        <ul class="sidebar-nav">
          <li><a href="10_Gatewayã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£.html" >Gatewayã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">ğŸ”„ å‚è€ƒ: ãƒ•ãƒ­ãƒ¼è§£èª¬</div>
        <ul class="sidebar-nav">
          <li><a href="11_ãƒãƒ£ãƒƒãƒˆé€ä¿¡ã®æµã‚Œ.html" >ãƒãƒ£ãƒƒãƒˆé€ä¿¡ã®æµã‚Œ</a></li>
          <li><a href="12_ãƒ­ã‚°ã‚¤ãƒ³ã®æµã‚Œ.html" >ãƒ­ã‚°ã‚¤ãƒ³ã®æµã‚Œ</a></li>
          <li><a href="13_ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®æµã‚Œ.html" >ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®æµã‚Œ</a></li>
        </ul>
      </div>
    </aside>

    <main class="main">
      <article class="content">
        <h1 id="ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è§£èª¬">ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è§£èª¬<a class="header-link" href="#ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è§£èª¬" title="Permanent link">&para;</a></h1>
<div class="chapter-hero">
<span class="emoji">ğŸ¨</span>
<h1>ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è§£èª¬</h1>
<p class="subtitle">ã€Œãˆï¼ŸReactã£ã¦ãƒ¬ã‚´ãƒ–ãƒ­ãƒƒã‚¯ã¿ãŸã„ãªã‚‚ã®ï¼Ÿã€<br>ã€Œãã†ï¼ç”»é¢ã®ãƒ‘ãƒ¼ãƒ„ã‚’çµ„ã¿åˆã‚ã›ã¦ä½œã‚‹ã‚“ã ï¼ã€</p>
</div>

<hr />
<h2 id="ã“ã®ç« ã§å­¦ã¶ã“ã¨">ã“ã®ç« ã§å­¦ã¶ã“ã¨<a class="header-link" href="#ã“ã®ç« ã§å­¦ã¶ã“ã¨" title="Permanent link">&para;</a></h2>
<div class="goal-box">
<h3>ğŸ“š å­¦ç¿’ç›®æ¨™</h3>
<ol>
<li>Reactã®åŸºæœ¬æ¦‚å¿µï¼ˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€JSXï¼‰</li>
<li>useState ã¨ useEffect ã®ä»•çµ„ã¿</li>
<li>ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã®ä½œã‚Šæ–¹ã¨ä½¿ã„æ–¹</li>
<li>èªè¨¼å‡¦ç†ã®æµã‚Œï¼ˆuseAuth.tsï¼‰</li>
<li>ãƒãƒ£ãƒƒãƒˆå‡¦ç†ã®æµã‚Œï¼ˆuseChat.tsï¼‰</li>
<li>ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®ä»•çµ„ã¿ï¼ˆuseSessions.tsï¼‰</li>
<li>APIé€šä¿¡ã¨ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼ˆapi.tsï¼‰</li>
<li>TypeScriptã®å‹ã‚·ã‚¹ãƒ†ãƒ </li>
</ol>
<p><strong>â±ï¸ æƒ³å®šå­¦ç¿’æ™‚é–“: 45åˆ†</strong></p>
</div>

<hr />
<h2 id="ä½¿ã£ã¦ã„ã‚‹æŠ€è¡“">ä½¿ã£ã¦ã„ã‚‹æŠ€è¡“<a class="header-link" href="#ä½¿ã£ã¦ã„ã‚‹æŠ€è¡“" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>æŠ€è¡“</th>
<th>å½¹å‰²</th>
<th>ãªãœä½¿ã†ï¼Ÿ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>React</strong></td>
<td>UIã‚’ä½œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</td>
<td>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ç”»é¢ã‚’çµ„ã¿ç«‹ã¦ã‚‰ã‚Œã‚‹</td>
</tr>
<tr>
<td><strong>TypeScript</strong></td>
<td>å‹ã®ã‚ã‚‹JavaScript</td>
<td>é–“é•ã„ã‚’äº‹å‰ã«é˜²ã’ã‚‹</td>
</tr>
<tr>
<td><strong>Vite</strong></td>
<td>é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãƒ»ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«</td>
<td>è¶…é«˜é€Ÿï¼å¤‰æ›´ãŒå³åº§ã«åæ˜ </td>
</tr>
<tr>
<td><strong>Firebase SDK</strong></td>
<td>Firebaseé€£æº</td>
<td>èªè¨¼ã‚„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç°¡å˜ã«ä½¿ãˆã‚‹</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã‚’ç†è§£ã—ã‚ˆã†">ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã‚’ç†è§£ã—ã‚ˆã†<a class="header-link" href="#ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã‚’ç†è§£ã—ã‚ˆã†" title="Permanent link">&para;</a></h2>
<div class="info-box">
<h3>ğŸ“ æ‹¡å¼µå­ã®æ„å‘³</h3>
<table>
<tr><th>æ‹¡å¼µå­</th><th>æ„å‘³</th><th>ç”¨é€”</th></tr>
<tr><td><strong>.js</strong></td><td>JavaScript</td><td>æ™®é€šã®JavaScriptãƒ•ã‚¡ã‚¤ãƒ«</td></tr>
<tr><td><strong>.ts</strong></td><td>TypeScript</td><td>å‹ä»˜ãJavaScriptï¼ˆHTMLã‚’å«ã¾ãªã„ï¼‰</td></tr>
<tr><td><strong>.jsx</strong></td><td>JavaScript + JSX</td><td>Reactç”¨ï¼ˆHTMLã£ã½ã„è¨˜æ³•ã‚’å«ã‚€ï¼‰</td></tr>
<tr><td><strong>.tsx</strong></td><td>TypeScript + JSX</td><td>Reactç”¨ï¼‹å‹ä»˜ãï¼ˆ<strong>ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¸»å½¹</strong>ï¼‰</td></tr>
</table>
<p><strong>ã€.tsx ã®ãƒã‚¤ãƒ³ãƒˆã€‘</strong></p>
<pre>
// .ts ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆHTMLãªã—ï¼‰
function add(a: number, b: number): number {
  return a + b;
}

// .tsx ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆHTMLã‚ã‚Š = JSXï¼‰
function Button(): JSX.Element {
  return &lt;button&gt;ã‚¯ãƒªãƒƒã‚¯&lt;/button&gt;;  // â† ã“ã‚ŒãŒJSX
}
</pre>
<p>ğŸ’¡ <strong>ä½¿ã„åˆ†ã‘:</strong></p>
<ul>
<li>UIã‚’å«ã‚€ï¼ˆç”»é¢ãƒ‘ãƒ¼ãƒ„ï¼‰â†’ <code>.tsx</code></li>
<li>UIã‚’å«ã¾ãªã„ï¼ˆãƒ­ã‚¸ãƒƒã‚¯ã®ã¿ï¼‰â†’ <code>.ts</code></li>
</ul>
</div>

<hr />
<h2 id="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆã®å…¨ä½“åƒ">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆã®å…¨ä½“åƒ<a class="header-link" href="#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆã®å…¨ä½“åƒ" title="Permanent link">&para;</a></h2>
<div class="architecture-box">
<h3>ğŸ—ï¸ Reactãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹æˆ</h3>
<pre>
src/frontend/
â”œâ”€â”€ index.html           â† â˜… HTMLã®åœŸå°ï¼ˆ1å›ã ã‘èª­ã¿è¾¼ã¾ã‚Œã‚‹ï¼‰
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx         â† â˜… Reactã®èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ App.tsx          â† â˜… ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â””â”€â”€ components/      â† å„ç¨®UIãƒ‘ãƒ¼ãƒ„
â”œâ”€â”€ .env                 â† ç’°å¢ƒå¤‰æ•°ï¼ˆAPIã‚­ãƒ¼ãªã©ï¼‰
â””â”€â”€ vite.config.ts       â† Viteã®è¨­å®š
</pre>
</div>

<div class="warning-box">
<h3>âš ï¸ è¶…é‡è¦ï¼šã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä½•ã‚’æ›¸ãï¼Ÿ</h3>
<div class="box-content">

**ã€index.htmlã€‘å…¨ãƒšãƒ¼ã‚¸å…±é€šã§1å›ã ã‘èª­ã¿è¾¼ã‚€ã‚‚ã®**
- Google Tag Manager (GTM)
- Google Analytics
- å¤–éƒ¨CSS/ãƒ•ã‚©ãƒ³ãƒˆï¼ˆGoogle Fontsãªã©ï¼‰
- `<title>` ã‚„ `<meta>` ã‚¿ã‚°
- favicon ã®è¨­å®š


<div class="codehilite"><pre><span></span><code><span class="cm">&lt;!-- index.html ã®ä¾‹ --&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;ja&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="cm">&lt;!-- â†“ å…¨ãƒšãƒ¼ã‚¸å…±é€šã§1å›ã ã‘èª­ã¿è¾¼ã‚€ã‚‚ã® --&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>AIãƒãƒ£ãƒƒãƒˆ<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;icon&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/favicon.ico&quot;</span> <span class="p">/&gt;</span>

  <span class="cm">&lt;!-- GTMï¼ˆGoogle Tag Managerï¼‰--&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;(</span><span class="kd">function</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">l</span><span class="p">,</span><span class="nx">i</span><span class="p">){...})(</span><span class="nb">window</span><span class="p">,</span><span class="nb">document</span><span class="p">,</span><span class="s1">&#39;script&#39;</span><span class="p">,</span><span class="s1">&#39;dataLayer&#39;</span><span class="p">,</span><span class="s1">&#39;GTM-XXXX&#39;</span><span class="p">);&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

  <span class="cm">&lt;!-- Google Fonts --&gt;</span>
  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://fonts.googleapis.com/css2?family=Noto+Sans+JP&amp;display=swap&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="cm">&lt;!-- â†“ ReactãŒã“ã“ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æç”»ã™ã‚‹ --&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;root&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="cm">&lt;!-- â†“ main.tsx ã‚’èª­ã¿è¾¼ã‚“ã§Reactã‚’èµ·å‹• --&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;module&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/src/main.tsx&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>



**ã€main.tsxã€‘Reactã‚’èµ·å‹•ã™ã‚‹ã ã‘**
- `index.html` ã® `#root` ã«Reactã‚¢ãƒ—ãƒªã‚’åŸ‹ã‚è¾¼ã‚€
- åŸºæœ¬çš„ã«å¤‰æ›´ä¸è¦


<div class="codehilite"><pre><span></span><code><span class="c1">// main.tsx</span>
<span class="k">import</span><span class="w"> </span><span class="nx">React</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">ReactDOM</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react-dom/client&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">App</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./App&#39;</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">createRoot</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">)</span><span class="o">!</span><span class="p">).</span><span class="nx">render</span><span class="p">(</span>
<span class="w">  </span><span class="p">&lt;</span><span class="nt">React</span><span class="p">.</span><span class="na">StrictMode</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">App</span><span class="w"> </span><span class="p">/&gt;</span><span class="w">  </span><span class="p">{</span><span class="cm">/* â† ã“ã“ã‹ã‚‰Reactã®ä¸–ç•ŒãŒå§‹ã¾ã‚‹ */</span><span class="p">}</span>
<span class="w">  </span><span class="p">&lt;/</span><span class="nt">React</span><span class="p">.</span><span class="na">StrictMode</span><span class="p">&gt;</span>
<span class="p">)</span>
</code></pre></div>



**ã€App.tsx ä»¥ä¸‹ã€‘ç”»é¢ã®ä¸­èº«**
- ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã«ã‚ˆã‚‹è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
- ãƒãƒ£ãƒƒãƒˆç”»é¢
- ãƒ˜ãƒƒãƒ€ãƒ¼ã€ãƒ•ãƒƒã‚¿ãƒ¼ãªã©ã®UI
- å‹•çš„ã«å¤‰ã‚ã‚‹éƒ¨åˆ†ã¯ã™ã¹ã¦ã“ã“

</div>
</div>

<div class="flow-box">
<h3>ğŸ”„ èª­ã¿è¾¼ã¾ã‚Œã‚‹é †ç•ª</h3>
<pre>
ãƒ–ãƒ©ã‚¦ã‚¶
  â”‚
  â†“ â‘  index.html ã‚’èª­ã‚€
  â”‚
  â”œâ”€â–¶ &lt;head&gt; ã®ä¸­èº«ã‚’å‡¦ç†
  â”‚     ãƒ»GTM ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
  â”‚     ãƒ»CSS/ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿
  â”‚
  â”œâ”€â–¶ &lt;body&gt; ã®ä¸­èº«ã‚’å‡¦ç†
  â”‚     ãƒ»#root ã¨ã„ã†ç©ºã® div ã‚’ä½œæˆ
  â”‚
  â†“ â‘¡ main.tsx ã‚’èª­ã‚€
  â”‚
  â”œâ”€â–¶ React ã‚’èµ·å‹•
  â”‚     ãƒ»#root ã« App ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æç”»
  â”‚
  â†“ â‘¢ App.tsx ãŒæç”»ã•ã‚Œã‚‹
  â”‚
  â””â”€â–¶ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œã«å¿œã˜ã¦ç”»é¢ãŒæ›´æ–°
        ãƒ»ãƒ­ã‚°ã‚¤ãƒ³ â†’ ChatScreen
        ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ â†’ ç”»é¢æ›´æ–°
</pre>
<p><strong>ãƒã‚¤ãƒ³ãƒˆ:</strong> index.html ã¯ã€Œå™¨ã€ã€React ã¯ã€Œä¸­èº«ã€ã‚’æ‹…å½“</p>
</div>

<hr />
<h2 id="ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆè©³ç´°">ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼ˆè©³ç´°ï¼‰<a class="header-link" href="#ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆè©³ç´°" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code>src/frontend/src/
â”œâ”€â”€ App.tsx              â† ğŸ¯ ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆã“ã“ã‹ã‚‰å§‹ã¾ã‚‹ï¼‰
â”œâ”€â”€ main.tsx             â† ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆReactã®èµ·å‹•ï¼‰
â”œâ”€â”€ hooks/               â† ğŸ£ ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ï¼ˆãƒ­ã‚¸ãƒƒã‚¯ã‚’å†åˆ©ç”¨ï¼‰
â”‚   â”œâ”€â”€ useAuth.ts       â† ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ï¼ˆUIãªã— â†’ .tsï¼‰
â”‚   â”œâ”€â”€ useChat.ts       â† ãƒãƒ£ãƒƒãƒˆå‡¦ç†ï¼ˆUIãªã— â†’ .tsï¼‰
â”‚   â””â”€â”€ useSessions.ts   â† ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ï¼ˆUIãªã— â†’ .tsï¼‰
â”œâ”€â”€ services/            â† å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº
â”‚   â”œâ”€â”€ firebase.ts      â† FirebaseåˆæœŸåŒ–ï¼ˆUIãªã— â†’ .tsï¼‰
â”‚   â””â”€â”€ api.ts           â† APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆUIãªã— â†’ .tsï¼‰
â”œâ”€â”€ components/          â† UIãƒ‘ãƒ¼ãƒ„
â”‚   â”œâ”€â”€ ChatScreen.tsx   â† ãƒãƒ£ãƒƒãƒˆç”»é¢ï¼ˆUIã‚ã‚Š â†’ .tsxï¼‰
â”‚   â””â”€â”€ LoginScreen.tsx  â† ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ï¼ˆUIã‚ã‚Š â†’ .tsxï¼‰
â””â”€â”€ renderers/           â† ã€ä¸Šç´šè€…å‘ã‘ã€‘ãƒãƒ£ãƒƒãƒˆè¡¨ç¤ºã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
</code></pre></div>

<div class="tip-box">
<h3>ğŸ’¡ å­¦ç¿’ã®ãƒã‚¤ãƒ³ãƒˆ</h3>
<p>ã¾ãšç†è§£ã™ã¹ããƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå„ªå…ˆé †ä½é †ï¼‰:</p>
<ol>
<li><strong>App.tsx</strong> â† å…¨ä½“ã®æµã‚Œã‚’æŠŠæ¡</li>
<li><strong>useAuth.ts</strong> â† èªè¨¼ã®ä»•çµ„ã¿</li>
<li><strong>useChat.ts</strong> â† ãƒãƒ£ãƒƒãƒˆã®ä»•çµ„ã¿</li>
<li><strong>useSessions.ts</strong> â† ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†</li>
<li><strong>api.ts</strong> â† APIé€šä¿¡ã®ä»•çµ„ã¿</li>
</ol>
<p>renderers/ ã¯ä¸Šç´šè€…å‘ã‘ã€‚æœ€åˆã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¦OKï¼</p>
</div>

<hr />
<h2 id="1-reactã®åŸºæœ¬æ¦‚å¿µ">1. Reactã®åŸºæœ¬æ¦‚å¿µ<a class="header-link" href="#1-reactã®åŸºæœ¬æ¦‚å¿µ" title="Permanent link">&para;</a></h2>
<h3 id="ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã¯">ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã¯ï¼Ÿ<a class="header-link" href="#ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã¯" title="Permanent link">&para;</a></h3>
<div class="architecture-box">
<h3>ğŸ§± ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ = ç”»é¢ã®ãƒ‘ãƒ¼ãƒ„ï¼ˆãƒ¬ã‚´ãƒ–ãƒ­ãƒƒã‚¯ï¼‰</h3>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Appï¼ˆè¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  LoginScreen          ã¾ãŸã¯         ChatScreen              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ LoginButton â”‚                    â”‚ SessionList        â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ MessageList        â”‚ â”‚ â”‚
â”‚  â”‚                                      â”‚ InputField         â”‚ â”‚ â”‚
â”‚  â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
<p>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµ„ã¿åˆã‚ã›ã¦ç”»é¢å…¨ä½“ã‚’ä½œã‚‹ï¼</p>
</div>

<h3 id="jsxjavascript--html">JSXï¼ˆJavaScript + HTMLï¼‰<a class="header-link" href="#jsxjavascript--html" title="Permanent link">&para;</a></h3>
<p>Reactã§ã¯JSXã¨ã„ã†è¨˜æ³•ã‚’ä½¿ã„ã¾ã™ã€‚<br />
JavaScript ã®ä¸­ã« HTML ã£ã½ãæ›¸ã‘ã‚‹ï¼</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¾‹</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">MyButton</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// JavaScript ã®ä¸­ã« HTML ã£ã½ãæ›¸ã‘ã‚‹ï¼</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span><span class="nx">ã‚¯ãƒªãƒƒã‚¯</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;;</span>
<span class="p">}</span>

<span class="c1">// ä½¿ã†å´</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">ã“ã‚“ã«ã¡ã¯</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">MyButton</span><span class="w"> </span><span class="p">/&gt;</span><span class="w">  </span><span class="p">{</span><span class="cm">/* â† è‡ªä½œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ã† */</span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="info-box">
<h3>ğŸ“ JSXã®ç‰¹å¾´</h3>
<ul>
<li>âœ… HTML ã£ã½ãæ›¸ã‘ã‚‹ï¼ˆã§ã‚‚å®Ÿã¯ JavaScriptï¼‰</li>
<li>âœ… {} ã®ä¸­ã« JavaScript ã‚’æ›¸ã‘ã‚‹</li>
<li>âœ… è‡ªä½œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ &lt;MyComponent /&gt; ã®ã‚ˆã†ã«ä½¿ã†</li>
<li>âœ… class ã¯ className ã¨æ›¸ãï¼ˆJSã®äºˆç´„èªã ã‹ã‚‰ï¼‰</li>
</ul>
<p><strong>ä¾‹:</strong></p>
<pre>const name = "å¤ªéƒ";
return &lt;h1&gt;ã“ã‚“ã«ã¡ã¯ã€{name}ã•ã‚“ï¼&lt;/h1&gt;;
// â†’ "ã“ã‚“ã«ã¡ã¯ã€å¤ªéƒã•ã‚“ï¼" ã¨è¡¨ç¤ºã•ã‚Œã‚‹</pre>
</div>

<hr />
<h2 id="2-usestate---çŠ¶æ…‹ç®¡ç†ã®åŸºæœ¬">2. useState - çŠ¶æ…‹ç®¡ç†ã®åŸºæœ¬<a class="header-link" href="#2-usestate---çŠ¶æ…‹ç®¡ç†ã®åŸºæœ¬" title="Permanent link">&para;</a></h2>
<h3 id="usestate-ã¨ã¯">useState ã¨ã¯ï¼Ÿ<a class="header-link" href="#usestate-ã¨ã¯" title="Permanent link">&para;</a></h3>
<p>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ã€ŒçŠ¶æ…‹ï¼ˆãƒ‡ãƒ¼ã‚¿ï¼‰ã€ã‚’æŒã¤ãŸã‚ã®ä»•çµ„ã¿ã€‚<br />
çŠ¶æ…‹ãŒå¤‰ã‚ã‚‹ã¨ã€ç”»é¢ãŒè‡ªå‹•ã§å†æç”»ã•ã‚Œã‚‹ï¼</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">Counter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="w">  </span><span class="c1">// â”‚ useState(åˆæœŸå€¤) ã®æˆ»ã‚Šå€¤:                                       â”‚</span>
<span class="w">  </span><span class="c1">// â”‚   [0] ç¾åœ¨ã®å€¤ï¼ˆcountï¼‰                                          â”‚</span>
<span class="w">  </span><span class="c1">// â”‚   [1] å€¤ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°ï¼ˆsetCountï¼‰                                â”‚</span>
<span class="w">  </span><span class="c1">// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">setCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// åˆæœŸå€¤ã¯ 0</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">ã‚«ã‚¦ãƒ³ãƒˆ</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">count</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">)}&gt;</span>
<span class="w">        </span><span class="o">+</span><span class="mf">1</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="flow-box">
<h3>ğŸ”„ useState ã®å‹•ä½œ</h3>
<ol>
<li><strong>æœ€åˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°</strong><br>count = 0<br>ç”»é¢: ã€Œã‚«ã‚¦ãƒ³ãƒˆ: 0ã€</li>
<li><strong>ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</strong><br>setCount(0 + 1) ãŒå‘¼ã°ã‚Œã‚‹</li>
<li><strong>React ãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°</strong><br>count = 1<br>ç”»é¢: ã€Œã‚«ã‚¦ãƒ³ãƒˆ: 1ã€ â† è‡ªå‹•ã§æ›´æ–°ï¼</li>
</ol>
<p>âš ï¸ ç›´æ¥ count = 1 ã¨æ›¸ã„ã¦ã‚‚ç”»é¢ã¯æ›´æ–°ã•ã‚Œãªã„ï¼<br>å¿…ãš setCount() ã‚’ä½¿ã†ï¼</p>
</div>

<h3 id="é…åˆ—ã®åˆ†å‰²ä»£å…¥">é…åˆ—ã®åˆ†å‰²ä»£å…¥<a class="header-link" href="#é…åˆ—ã®åˆ†å‰²ä»£å…¥" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// ã“ã‚Œä½•ï¼Ÿã¨æ€ã£ãŸäººã¸</span>
<span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">setCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>

<span class="c1">// â†‘ ã¯ä»¥ä¸‹ã¨åŒã˜æ„å‘³</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span><span class="w">      </span><span class="c1">// [0, é–¢æ•°] ãŒè¿”ã£ã¦ãã‚‹</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span><span class="w">         </span><span class="c1">// ç¾åœ¨ã®å€¤</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">setCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span><span class="w">      </span><span class="c1">// æ›´æ–°é–¢æ•°</span>

<span class="c1">// ã€Œé…åˆ—ã®åˆ†å‰²ä»£å…¥ã€ã¨ã„ã† JavaScript ã®æ©Ÿèƒ½</span>
<span class="c1">// é…åˆ—ã®è¦ç´ ã‚’å¤‰æ•°ã«å±•é–‹ã§ãã‚‹</span>
<span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">first</span><span class="p">,</span><span class="w"> </span><span class="nx">second</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">];</span><span class="w">  </span><span class="c1">// first = 1, second = 2</span>
</code></pre></div>

<hr />
<h2 id="3-useeffect---å‰¯ä½œç”¨ã®å‡¦ç†">3. useEffect - å‰¯ä½œç”¨ã®å‡¦ç†<a class="header-link" href="#3-useeffect---å‰¯ä½œç”¨ã®å‡¦ç†" title="Permanent link">&para;</a></h2>
<h3 id="useeffect-ã¨ã¯">useEffect ã¨ã¯ï¼Ÿ<a class="header-link" href="#useeffect-ã¨ã¯" title="Permanent link">&para;</a></h3>
<p>ã€Œå‰¯ä½œç”¨ï¼ˆSide Effectï¼‰ã€ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã€‚<br />
å‰¯ä½œç”¨ = ç”»é¢æç”»ä»¥å¤–ã®å‡¦ç†ï¼ˆAPIå‘¼ã³å‡ºã—ã€ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ãªã©ï¼‰</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">UserProfile</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">setUser</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="w">  </span><span class="c1">// â”‚ useEffect(å‡¦ç†, ä¾å­˜é…åˆ—)                                        â”‚</span>
<span class="w">  </span><span class="c1">// â”‚   å‡¦ç†: å®Ÿè¡Œã—ãŸã„é–¢æ•°                                            â”‚</span>
<span class="w">  </span><span class="c1">// â”‚   ä¾å­˜é…åˆ—: ã“ã®å€¤ãŒå¤‰ã‚ã£ãŸã‚‰å†å®Ÿè¡Œ                               â”‚</span>
<span class="w">  </span><span class="c1">// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚ŒãŸã¨ãã«å®Ÿè¡Œ</span>
<span class="w">    </span><span class="nx">fetchUser</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setUser</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span><span class="w">  </span><span class="c1">// [] = æœ€åˆã®1å›ã ã‘å®Ÿè¡Œ</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;{</span><span class="nx">user</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="ä¾å­˜é…åˆ—ã®ãƒ‘ã‚¿ãƒ¼ãƒ³">ä¾å­˜é…åˆ—ã®ãƒ‘ã‚¿ãƒ¼ãƒ³<a class="header-link" href="#ä¾å­˜é…åˆ—ã®ãƒ‘ã‚¿ãƒ¼ãƒ³" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// ãƒ‘ã‚¿ãƒ¼ãƒ³1: æœ€åˆã®1å›ã ã‘å®Ÿè¡Œ</span>
<span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;ãƒã‚¦ãƒ³ãƒˆæ™‚ã«1å›ã ã‘&quot;</span><span class="p">);</span>
<span class="p">},</span><span class="w"> </span><span class="p">[]);</span>

<span class="c1">// ãƒ‘ã‚¿ãƒ¼ãƒ³2: ç‰¹å®šã®å€¤ãŒå¤‰ã‚ã£ãŸã‚‰å®Ÿè¡Œ</span>
<span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;userId ãŒå¤‰ã‚ã£ãŸã‚‰å®Ÿè¡Œ&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="nx">fetchUserData</span><span class="p">(</span><span class="nx">userId</span><span class="p">);</span>
<span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">userId</span><span class="p">]);</span><span class="w">  </span><span class="c1">// userId ãŒå¤‰ã‚ã‚‹ãŸã³ã«å®Ÿè¡Œ</span>

<span class="c1">// ãƒ‘ã‚¿ãƒ¼ãƒ³3: æ¯å›å®Ÿè¡Œï¼ˆéæ¨å¥¨ï¼‰</span>
<span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;æ¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§å®Ÿè¡Œ&quot;</span><span class="p">);</span>
<span class="p">});</span><span class="w">  </span><span class="c1">// ä¾å­˜é…åˆ—ãªã— = æ¯å›å®Ÿè¡Œ</span>

<span class="c1">// ãƒ‘ã‚¿ãƒ¼ãƒ³4: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ä»˜ã</span>
<span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">subscription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">subscribeToData</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ¶ˆãˆã‚‹ã¨ãã«å®Ÿè¡Œ</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">subscription</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">();</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">},</span><span class="w"> </span><span class="p">[]);</span>
</code></pre></div>

<div class="info-box">
<h3>ğŸ¯ useEffect ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«</h3>
<p>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¸€ç”Ÿ:</p>
<pre>
[ãƒã‚¦ãƒ³ãƒˆ] â”€â”€â”€â”€â”€â†’ [æ›´æ–°] â”€â”€â”€â”€â”€â†’ [æ›´æ–°] â”€â”€â”€â”€â”€â†’ [ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆ]
    â†“                â†“            â†“                â†“
useEffect        ä¾å­˜é…åˆ—ã®     ä¾å­˜é…åˆ—ã®      ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
å®Ÿè¡Œ             å€¤ãŒå¤‰ã‚ã£ãŸ   å€¤ãŒå¤‰ã‚ã£ãŸ      é–¢æ•°å®Ÿè¡Œ
                 ã‚‰å†å®Ÿè¡Œ       ã‚‰å†å®Ÿè¡Œ
</pre>
<ul>
<li><strong>ãƒã‚¦ãƒ³ãƒˆ</strong> = ç”»é¢ã«è¡¨ç¤ºã•ã‚ŒãŸã¨ã</li>
<li><strong>ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆ</strong> = ç”»é¢ã‹ã‚‰æ¶ˆãˆãŸã¨ã</li>
</ul>
</div>

<hr />
<h2 id="4-ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯---ãƒ­ã‚¸ãƒƒã‚¯ã®å†åˆ©ç”¨">4. ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ - ãƒ­ã‚¸ãƒƒã‚¯ã®å†åˆ©ç”¨<a class="header-link" href="#4-ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯---ãƒ­ã‚¸ãƒƒã‚¯ã®å†åˆ©ç”¨" title="Permanent link">&para;</a></h2>
<h3 id="ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¨ã¯">ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¨ã¯ï¼Ÿ<a class="header-link" href="#ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¨ã¯" title="Permanent link">&para;</a></h3>
<p><code>use</code> ã§å§‹ã¾ã‚‹é–¢æ•°ã€‚useState ã‚„ useEffect ã‚’çµ„ã¿åˆã‚ã›ã¦ã€<br />
ãƒ­ã‚¸ãƒƒã‚¯ã‚’å†åˆ©ç”¨å¯èƒ½ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã™ã‚‹ã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’ä½œã‚‹</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">useCounter</span><span class="p">(</span><span class="nx">initialValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">setCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="nx">initialValue</span><span class="p">);</span>

<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">increment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">decrement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setCount</span><span class="p">(</span><span class="nx">initialValue</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">increment</span><span class="p">,</span><span class="w"> </span><span class="nx">decrement</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="w"> </span><span class="p">};</span>
<span class="p">}</span>

<span class="c1">// ä½¿ã†å´A</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">ComponentA</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">increment</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCounter</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">increment</span><span class="p">}&gt;{</span><span class="nx">count</span><span class="p">}&lt;/</span><span class="nt">button</span><span class="p">&gt;;</span>
<span class="p">}</span>

<span class="c1">// ä½¿ã†å´B</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">ComponentB</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">increment</span><span class="p">,</span><span class="w"> </span><span class="nx">reset</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCounter</span><span class="p">(</span><span class="mf">100</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// ComponentA ã¨ã¯åˆ¥ã®çŠ¶æ…‹ã‚’æŒã¤ï¼</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;{</span><span class="nx">count</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">increment</span><span class="p">}&gt;</span><span class="o">+</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">button</span><span class="w"> </span><span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">reset</span><span class="p">}&gt;</span><span class="nx">ãƒªã‚»ãƒƒãƒˆ</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="tip-box">
<h3>âœ¨ ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã®ãƒ¡ãƒªãƒƒãƒˆ</h3>
<ol>
<li><strong>ãƒ­ã‚¸ãƒƒã‚¯ã®å†åˆ©ç”¨</strong><br>åŒã˜å‡¦ç†ã‚’è¤‡æ•°ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ä½¿ã„å›ã›ã‚‹</li>
<li><strong>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¹ãƒƒã‚­ãƒª</strong><br>è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ•ãƒƒã‚¯ã«åˆ†é›¢ â†’ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯è¡¨ç¤ºã«å°‚å¿µ</li>
<li><strong>ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„</strong><br>UIãªã—ã§ãƒ­ã‚¸ãƒƒã‚¯ã ã‘ãƒ†ã‚¹ãƒˆã§ãã‚‹</li>
</ol>
<p>âš ï¸ ãƒ«ãƒ¼ãƒ«:</p>
<ul>
<li>åå‰ã¯å¿…ãš use ã§å§‹ã‚ã‚‹ï¼ˆä¾‹: useAuth, useChatï¼‰</li>
<li>ãƒ•ãƒƒã‚¯ã¯ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§ã®ã¿å‘¼ã³å‡ºã™ï¼ˆifæ–‡ã®ä¸­ã¯ãƒ€ãƒ¡ï¼‰</li>
</ul>
</div>

<hr />
<h2 id="5-apptsx---ã‚¢ãƒ—ãƒªã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ">5. App.tsx - ã‚¢ãƒ—ãƒªã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ<a class="header-link" href="#5-apptsx---ã‚¢ãƒ—ãƒªã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ" title="Permanent link">&para;</a></h2>
<p>ã“ã®ã‚¢ãƒ—ãƒªã®ã€Œè¦ªç‰ã€ã€‚å…¨ä½“ã®æµã‚Œã‚’ç®¡ç†ã—ã¾ã™ã€‚</p>
<h3 id="å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ã‚³ãƒ¡ãƒ³ãƒˆä»˜ã">å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆä»˜ãï¼‰<a class="header-link" href="#å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ã‚³ãƒ¡ãƒ³ãƒˆä»˜ã" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * App.tsx - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</span>
<span class="cm"> *</span>
<span class="cm"> * å½¹å‰²:</span>
<span class="cm"> *   - æœªãƒ­ã‚°ã‚¤ãƒ³ â†’ LoginScreen ã‚’è¡¨ç¤º</span>
<span class="cm"> *   - ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆ â†’ ChatScreen ã‚’è¡¨ç¤º</span>
<span class="cm"> */</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ChatScreen</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./components/ChatScreen&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">LoginScreen</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./components/LoginScreen&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useAuth</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./hooks/useAuth&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useChat</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./hooks/useChat&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useSessions</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./hooks/useSessions&#39;</span>

<span class="cm">/**</span>
<span class="cm"> * ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰: é–‹ç™ºç’°å¢ƒã§ã®ã¿æœ‰åŠ¹</span>
<span class="cm"> * - true: èªè¨¼ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ãƒãƒ£ãƒƒãƒˆç”»é¢ã‚’è¡¨ç¤ºï¼ˆç”»é¢ç¢ºèªç”¨ï¼‰</span>
<span class="cm"> * - false: é€šå¸¸ã®èªè¨¼ãƒ•ãƒ­ãƒ¼ã‚’ä½¿ç”¨</span>
<span class="cm"> */</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">DEBUG_SHOW_CHAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DEV</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VITE_DEBUG_MODE</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;true&#39;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">App</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’ä½¿ã£ã¦çŠ¶æ…‹ã‚’å–å¾—</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>

<span class="w">  </span><span class="c1">// èªè¨¼çŠ¶æ…‹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã€ãƒ­ã‚°ã‚¤ãƒ³é–¢æ•°ãªã©ï¼‰</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">loading</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">authError</span><span class="p">,</span><span class="w"> </span><span class="nx">loginWithGoogle</span><span class="p">,</span><span class="w"> </span><span class="nx">logout</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useAuth</span><span class="p">()</span>

<span class="w">  </span><span class="c1">// ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ï¼ˆè¤‡æ•°ã®ä¼šè©±ã‚’ç®¡ç†ï¼‰</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">sessions</span><span class="p">,</span><span class="w">              </span><span class="c1">// ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§</span>
<span class="w">    </span><span class="nx">activeSession</span><span class="p">,</span><span class="w">         </span><span class="c1">// ç¾åœ¨é¸æŠä¸­ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³</span>
<span class="w">    </span><span class="nx">activeSessionId</span><span class="p">,</span><span class="w">       </span><span class="c1">// ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ID</span>
<span class="w">    </span><span class="nx">createSession</span><span class="p">,</span><span class="w">         </span><span class="c1">// æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ</span>
<span class="w">    </span><span class="nx">switchSession</span><span class="p">,</span><span class="w">         </span><span class="c1">// ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆ</span>
<span class="w">    </span><span class="nx">closeSession</span><span class="p">,</span><span class="w">          </span><span class="c1">// ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤</span>
<span class="w">    </span><span class="nx">updateSessionMessages</span><span class="p">,</span><span class="w"> </span><span class="c1">// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ›´æ–°</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useSessions</span><span class="p">()</span>

<span class="w">  </span><span class="c1">// ãƒãƒ£ãƒƒãƒˆçŠ¶æ…‹ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€é€ä¿¡é–¢æ•°ãªã©ï¼‰</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">messages</span><span class="p">,</span><span class="w"> </span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">chatError</span><span class="p">,</span><span class="w"> </span><span class="nx">sendMessage</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useChat</span><span class="p">({</span>
<span class="w">    </span><span class="nx">activeSession</span><span class="p">,</span>
<span class="w">    </span><span class="nx">onMessagesUpdate</span><span class="o">:</span><span class="w"> </span><span class="kt">updateSessionMessages</span><span class="p">,</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// æ¡ä»¶åˆ†å²ã§è¡¨ç¤ºã™ã‚‹ç”»é¢ã‚’æ±ºå®š</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>

<span class="w">  </span><span class="c1">// ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ï¼ˆèªè¨¼çŠ¶æ…‹ã®ç¢ºèªä¸­ï¼‰</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">loading</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">DEBUG_SHOW_CHAT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;loading-screen&quot;</span><span class="p">&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="na">className</span><span class="o">=</span><span class="s">&quot;spinner&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">        </span><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nx">èª­ã¿è¾¼ã¿ä¸­</span><span class="p">...&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// æœªãƒ­ã‚°ã‚¤ãƒ³ â†’ ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’è¡¨ç¤º</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="nx">DEBUG_SHOW_CHAT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">&lt;</span><span class="nt">LoginScreen</span><span class="w"> </span><span class="na">onLogin</span><span class="o">=</span><span class="p">{</span><span class="nx">loginWithGoogle</span><span class="p">}</span><span class="w"> </span><span class="na">error</span><span class="o">=</span><span class="p">{</span><span class="nx">authError</span><span class="p">}</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ â†’ ãƒãƒ£ãƒƒãƒˆç”»é¢ã‚’è¡¨ç¤º</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">displayUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;demo@example.com&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">displayName</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Demo User&#39;</span><span class="w"> </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="p">&lt;</span><span class="nt">ChatScreen</span>
<span class="w">      </span><span class="na">user</span><span class="o">=</span><span class="p">{</span><span class="nx">displayUser</span><span class="p">}</span>
<span class="w">      </span><span class="na">messages</span><span class="o">=</span><span class="p">{</span><span class="nx">messages</span><span class="p">}</span>
<span class="w">      </span><span class="na">isLoading</span><span class="o">=</span><span class="p">{</span><span class="nx">isLoading</span><span class="p">}</span>
<span class="w">      </span><span class="na">error</span><span class="o">=</span><span class="p">{</span><span class="nx">chatError</span><span class="p">}</span>
<span class="w">      </span><span class="na">onSendMessage</span><span class="o">=</span><span class="p">{</span><span class="nx">sendMessage</span><span class="p">}</span>
<span class="w">      </span><span class="na">onLogout</span><span class="o">=</span><span class="p">{</span><span class="nx">logout</span><span class="p">}</span>
<span class="w">      </span><span class="na">sessions</span><span class="o">=</span><span class="p">{</span><span class="nx">sessions</span><span class="p">}</span>
<span class="w">      </span><span class="na">activeSessionId</span><span class="o">=</span><span class="p">{</span><span class="nx">activeSessionId</span><span class="p">}</span>
<span class="w">      </span><span class="na">onSelectSession</span><span class="o">=</span><span class="p">{</span><span class="nx">switchSession</span><span class="p">}</span>
<span class="w">      </span><span class="na">onNewSession</span><span class="o">=</span><span class="p">{</span><span class="nx">createSession</span><span class="p">}</span>
<span class="w">      </span><span class="na">onCloseSession</span><span class="o">=</span><span class="p">{</span><span class="nx">closeSession</span><span class="p">}</span>
<span class="w">    </span><span class="p">/&gt;</span>
<span class="w">  </span><span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">App</span>
</code></pre></div>

<div class="flow-box">
<h3>ğŸ” App.tsx ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼</h3>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  App èµ·å‹•   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ loading?   â”‚â”€â”€â”€â”€â–¶â”‚ ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢è¡¨ç¤ºï¼ˆã‚¹ãƒ”ãƒŠãƒ¼ï¼‰                  â”‚
â”‚   true     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚ false
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  user?     â”‚â”€â”€â”€â”€â–¶â”‚ LoginScreenï¼ˆãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ï¼‰                       â”‚
â”‚   null     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚ user ã‚ã‚Š
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatScreenï¼ˆãƒãƒ£ãƒƒãƒˆç”»é¢ï¼‰                                           â”‚
â”‚  - ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§                                                    â”‚
â”‚  - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º                                                    â”‚
â”‚  - å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
</div>

<hr />
<h2 id="6-useauthts---èªè¨¼ãƒ•ãƒƒã‚¯ã®å®Œå…¨è§£èª¬">6. useAuth.ts - èªè¨¼ãƒ•ãƒƒã‚¯ã®å®Œå…¨è§£èª¬<a class="header-link" href="#6-useauthts---èªè¨¼ãƒ•ãƒƒã‚¯ã®å®Œå…¨è§£èª¬" title="Permanent link">&para;</a></h2>
<h3 id="å®Œå…¨ãªã‚³ãƒ¼ãƒ‰">å®Œå…¨ãªã‚³ãƒ¼ãƒ‰<a class="header-link" href="#å®Œå…¨ãªã‚³ãƒ¼ãƒ‰" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * èªè¨¼ãƒ•ãƒƒã‚¯</span>
<span class="cm"> *</span>
<span class="cm"> * Firebase Authenticationã®çŠ¶æ…‹ã‚’ç®¡ç†ã—ã¾ã™ã€‚</span>
<span class="cm"> */</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">User</span><span class="p">,</span><span class="w"> </span><span class="nx">signInWithPopup</span><span class="p">,</span><span class="w"> </span><span class="nx">signOut</span><span class="p">,</span><span class="w"> </span><span class="nx">onAuthStateChanged</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;firebase/auth&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">auth</span><span class="p">,</span><span class="w"> </span><span class="nx">googleProvider</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../services/firebase&#39;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">useAuth</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// çŠ¶æ…‹ã®å®šç¾©</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">setUser</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">User</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">)</span><span class="w">      </span><span class="c1">// ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">loading</span><span class="p">,</span><span class="w"> </span><span class="nx">setLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w">              </span><span class="c1">// èª­ã¿è¾¼ã¿ä¸­ãƒ•ãƒ©ã‚°</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">)</span><span class="w">   </span><span class="c1">// ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// èªè¨¼çŠ¶æ…‹ã®ç›£è¦–ï¼ˆé‡è¦ï¼ï¼‰</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// onAuthStateChanged: Firebaseã®èªè¨¼çŠ¶æ…‹ãŒå¤‰ã‚ã£ãŸã‚‰å‘¼ã°ã‚Œã‚‹</span>
<span class="w">    </span><span class="c1">// - ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸã¨ã</span>
<span class="w">    </span><span class="c1">// - ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ãŸã¨ã</span>
<span class="w">    </span><span class="c1">// - ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ï¼ˆæ—¢å­˜ã®ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒï¼‰</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">unsubscribe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">onAuthStateChanged</span><span class="p">(</span><span class="nx">auth</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setUser</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span><span class="w">       </span><span class="c1">// ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ã‚»ãƒƒãƒˆï¼ˆnull = æœªãƒ­ã‚°ã‚¤ãƒ³ï¼‰</span>
<span class="w">      </span><span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w">   </span><span class="c1">// èª­ã¿è¾¼ã¿å®Œäº†</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="c1">// ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—: ç›£è¦–ã‚’è§£é™¤</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">unsubscribe</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[])</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// Googleã§ãƒ­ã‚°ã‚¤ãƒ³</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">loginWithGoogle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span><span class="w">  </span><span class="c1">// ã‚¨ãƒ©ãƒ¼ã‚’ã‚¯ãƒªã‚¢</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// signInWithPopup: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã§Googleãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’è¡¨ç¤º</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">signInWithPopup</span><span class="p">(</span><span class="nx">auth</span><span class="p">,</span><span class="w"> </span><span class="nx">googleProvider</span><span class="p">)</span>
<span class="w">      </span><span class="c1">// ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ â†’ onAuthStateChanged ãŒè‡ªå‹•ã§å‘¼ã°ã‚Œã‚‹</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setError</span><span class="p">(</span><span class="s1">&#39;ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">logout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">signOut</span><span class="p">(</span><span class="nx">auth</span><span class="p">)</span>
<span class="w">      </span><span class="c1">// ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæˆåŠŸ â†’ onAuthStateChanged ãŒè‡ªå‹•ã§å‘¼ã°ã‚Œã‚‹</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setError</span><span class="p">(</span><span class="s1">&#39;ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ&#39;</span><span class="p">)</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// æˆ»ã‚Šå€¤</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">user</span><span class="p">,</span><span class="w">                     </span><span class="c1">// Userã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ or null</span>
<span class="w">    </span><span class="nx">loading</span><span class="p">,</span><span class="w">                  </span><span class="c1">// èªè¨¼ç¢ºèªä¸­ã‹</span>
<span class="w">    </span><span class="nx">error</span><span class="p">,</span><span class="w">                    </span><span class="c1">// ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</span>
<span class="w">    </span><span class="nx">loginWithGoogle</span><span class="p">,</span><span class="w">          </span><span class="c1">// ãƒ­ã‚°ã‚¤ãƒ³é–¢æ•°</span>
<span class="w">    </span><span class="nx">logout</span><span class="p">,</span><span class="w">                   </span><span class="c1">// ãƒ­ã‚°ã‚¢ã‚¦ãƒˆé–¢æ•°</span>
<span class="w">    </span><span class="nx">isLoggedIn</span><span class="o">:</span><span class="w"> </span><span class="o">!!</span><span class="nx">user</span><span class="p">,</span><span class="w">       </span><span class="c1">// ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã‹ï¼ˆbooleanï¼‰</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="onauthstatechanged-ã®ä»•çµ„ã¿">onAuthStateChanged ã®ä»•çµ„ã¿<a class="header-link" href="#onauthstatechanged-ã®ä»•çµ„ã¿" title="Permanent link">&para;</a></h3>
<div class="flow-box">
<h3>ğŸ” onAuthStateChanged ã®å‹•ä½œ</h3>
<p><strong>ã€ãƒ‘ã‚¿ãƒ¼ãƒ³1: ãƒ­ã‚°ã‚¤ãƒ³ã€‘</strong></p>
<pre>
[ãƒ¦ãƒ¼ã‚¶ãƒ¼] â”€â”€â–¶ [Googleãƒ­ã‚°ã‚¤ãƒ³] â”€â”€â–¶ [Firebase]
                                        â”‚
                                        â–¼
[useAuth] â—€â”€â”€ onAuthStateChanged(user) â”€â”˜
    â”‚
    â–¼
setUser(user) â†’ ç”»é¢æ›´æ–°
</pre>
<p><strong>ã€ãƒ‘ã‚¿ãƒ¼ãƒ³2: ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã€‘</strong></p>
<pre>
[ãƒ–ãƒ©ã‚¦ã‚¶] â”€â”€â–¶ [ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿]
                   â”‚
                   â–¼
[Firebase] â”€â”€ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èªè¨¼æƒ…å ±ã‚’å¾©å…ƒ
    â”‚
    â–¼
[useAuth] â—€â”€â”€ onAuthStateChanged(user)
    â”‚
    â–¼
è‡ªå‹•çš„ã«ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ãŒå¾©å…ƒï¼
</pre>
<p><strong>ã€ãƒã‚¤ãƒ³ãƒˆã€‘</strong><br>
Firebase ãŒèªè¨¼çŠ¶æ…‹ã‚’ localStorage ã«ä¿å­˜ã—ã¦ãã‚Œã‚‹<br>
â†’ ãƒšãƒ¼ã‚¸ã‚’é–‰ã˜ã¦ã‚‚ã€å†è¨ªå•æ™‚ã«è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ï¼</p>
</div>

<hr />
<h2 id="7-usechatts---ãƒãƒ£ãƒƒãƒˆãƒ•ãƒƒã‚¯ã®å®Œå…¨è§£èª¬">7. useChat.ts - ãƒãƒ£ãƒƒãƒˆãƒ•ãƒƒã‚¯ã®å®Œå…¨è§£èª¬<a class="header-link" href="#7-usechatts---ãƒãƒ£ãƒƒãƒˆãƒ•ãƒƒã‚¯ã®å®Œå…¨è§£èª¬" title="Permanent link">&para;</a></h2>
<h3 id="å®Œå…¨ãªã‚³ãƒ¼ãƒ‰_1">å®Œå…¨ãªã‚³ãƒ¼ãƒ‰<a class="header-link" href="#å®Œå…¨ãªã‚³ãƒ¼ãƒ‰_1" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * ãƒãƒ£ãƒƒãƒˆãƒ•ãƒƒã‚¯</span>
<span class="cm"> *</span>
<span class="cm"> * AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®ä¼šè©±ã‚’ç®¡ç†ã—ã¾ã™ã€‚</span>
<span class="cm"> * ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ•ãƒƒã‚¯ã¨é€£æºã—ã¦å‹•ä½œã—ã¾ã™ã€‚</span>
<span class="cm"> */</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">sendChatMessage</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;../services/api&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">ChatSession</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./useSessions&#39;</span>

<span class="cm">/**</span>
<span class="cm"> * ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªIDã‚’ç”Ÿæˆ</span>
<span class="cm"> * crypto.randomUUID()ã‚’ä½¿ç”¨ã—ã¦è¡çªã®ãªã„IDã‚’ç”Ÿæˆ</span>
<span class="cm"> */</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">generateUniqueId</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">crypto</span><span class="p">.</span><span class="nx">randomUUID</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å‹</span>
<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">Message</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w">                    </span><span class="c1">// ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªID</span>
<span class="w">  </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;assistant&#39;</span><span class="w">    </span><span class="c1">// èª°ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹</span>
<span class="w">  </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w">               </span><span class="c1">// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹</span>
<span class="p">}</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">UseChatOptions</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">activeSession</span><span class="o">:</span><span class="w"> </span><span class="kt">ChatSession</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span>
<span class="w">  </span><span class="nx">onMessagesUpdate</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">sessionId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">messages</span><span class="o">:</span><span class="w"> </span><span class="kt">Message</span><span class="p">[],</span><span class="w"> </span><span class="nx">threadId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">useChat</span><span class="p">(</span><span class="nx">options?</span><span class="o">:</span><span class="w"> </span><span class="kt">UseChatOptions</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">activeSession</span><span class="p">,</span><span class="w"> </span><span class="nx">onMessagesUpdate</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">options</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// çŠ¶æ…‹ã®å®šç¾©</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">messages</span><span class="p">,</span><span class="w"> </span><span class="nx">setMessages</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">Message</span><span class="err">[]</span><span class="p">&gt;(</span><span class="nx">activeSession</span><span class="o">?</span><span class="p">.</span><span class="nx">messages</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[])</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">threadId</span><span class="p">,</span><span class="w"> </span><span class="nx">setThreadId</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="nx">activeSession</span><span class="o">?</span><span class="p">.</span><span class="nx">threadId</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">setIsLoading</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">setError</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">)</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¾©å…ƒ</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activeSession</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setMessages</span><span class="p">(</span><span class="nx">activeSession</span><span class="p">.</span><span class="nx">messages</span><span class="p">)</span>
<span class="w">      </span><span class="nx">setThreadId</span><span class="p">(</span><span class="nx">activeSession</span><span class="p">.</span><span class="nx">threadId</span><span class="p">)</span>
<span class="w">      </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">activeSession</span><span class="o">?</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span><span class="w">  </span><span class="c1">// ã‚»ãƒƒã‚·ãƒ§ãƒ³IDãŒå¤‰ã‚ã£ãŸã‚‰å®Ÿè¡Œ</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sendMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ç©ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„é€ä¿¡ä¸­ã¯ç„¡è¦–</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">content</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">isLoading</span><span class="p">)</span><span class="w"> </span><span class="k">return</span>

<span class="w">    </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
<span class="w">    </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">    </span><span class="c1">// Step 1: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ </span>
<span class="w">    </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">userMessage</span><span class="o">:</span><span class="w"> </span><span class="kt">Message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">generateUniqueId</span><span class="p">(),</span>
<span class="w">      </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">content</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">updatedMessagesWithUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...</span><span class="nx">messages</span><span class="p">,</span><span class="w"> </span><span class="nx">userMessage</span><span class="p">]</span>
<span class="w">    </span><span class="nx">setMessages</span><span class="p">(</span><span class="nx">updatedMessagesWithUser</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">    </span><span class="c1">// Step 2: AIã®å¿œç­”ç”¨ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’è¿½åŠ </span>
<span class="w">    </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">assistantMessageId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateUniqueId</span><span class="p">()</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">assistantMessage</span><span class="o">:</span><span class="w"> </span><span class="kt">Message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">assistantMessageId</span><span class="p">,</span>
<span class="w">      </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;assistant&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">// æœ€åˆã¯ç©º</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">updatedMessagesWithAssistant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...</span><span class="nx">updatedMessagesWithUser</span><span class="p">,</span><span class="w"> </span><span class="nx">assistantMessage</span><span class="p">]</span>
<span class="w">    </span><span class="nx">setMessages</span><span class="p">(</span><span class="nx">updatedMessagesWithAssistant</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">    </span><span class="c1">// Step 3: ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡</span>
<span class="w">    </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">let</span><span class="w"> </span><span class="nx">currentContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>

<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">newThreadId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">sendChatMessage</span><span class="p">(</span>
<span class="w">        </span><span class="nx">content</span><span class="p">,</span>
<span class="w">        </span><span class="nx">threadId</span><span class="p">,</span>
<span class="w">        </span><span class="p">(</span><span class="nx">chunk</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="c1">// ãƒãƒ£ãƒ³ã‚¯ï¼ˆæ–­ç‰‡ï¼‰ã‚’å—ä¿¡ã™ã‚‹ãŸã³ã«å‘¼ã°ã‚Œã‚‹</span>
<span class="w">          </span><span class="nx">currentContent</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">chunk</span>

<span class="w">          </span><span class="c1">// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›´æ–°ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºï¼ï¼‰</span>
<span class="w">          </span><span class="nx">setMessages</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">            </span><span class="nx">prev</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">msg</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">              </span><span class="nx">msg</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">assistantMessageId</span>
<span class="w">                </span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">msg</span><span class="p">,</span><span class="w"> </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="kt">currentContent</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="o">:</span><span class="w"> </span><span class="nx">msg</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">          </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">)</span>

<span class="w">      </span><span class="nx">setThreadId</span><span class="p">(</span><span class="nx">newThreadId</span><span class="p">)</span>

<span class="w">      </span><span class="c1">// ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activeSession</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">onMessagesUpdate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">finalMessages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">updatedMessagesWithUser</span><span class="p">.</span><span class="nx">concat</span><span class="p">({</span>
<span class="w">          </span><span class="p">...</span><span class="nx">assistantMessage</span><span class="p">,</span>
<span class="w">          </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="kt">currentContent</span><span class="p">,</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">        </span><span class="nx">onMessagesUpdate</span><span class="p">(</span><span class="nx">activeSession</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">finalMessages</span><span class="p">,</span><span class="w"> </span><span class="nx">newThreadId</span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">      </span><span class="c1">// ã‚¨ãƒ©ãƒ¼å‡¦ç†</span>
<span class="w">      </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ&#39;</span>
<span class="w">      </span><span class="nx">setError</span><span class="p">(</span><span class="nx">errorMessage</span><span class="p">)</span>

<span class="w">      </span><span class="c1">// å¤±æ•—ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤</span>
<span class="w">      </span><span class="nx">setMessages</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">prev</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">msg</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">msg</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">assistantMessageId</span><span class="p">))</span>

<span class="w">      </span><span class="c1">// ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¾ã§ä¿å­˜</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">activeSession</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">onMessagesUpdate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">onMessagesUpdate</span><span class="p">(</span><span class="nx">activeSession</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">updatedMessagesWithUser</span><span class="p">,</span><span class="w"> </span><span class="nx">threadId</span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">threadId</span><span class="p">,</span><span class="w"> </span><span class="nx">isLoading</span><span class="p">,</span><span class="w"> </span><span class="nx">messages</span><span class="p">,</span><span class="w"> </span><span class="nx">activeSession</span><span class="p">,</span><span class="w"> </span><span class="nx">onMessagesUpdate</span><span class="p">])</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// ä¼šè©±ã‚’ãƒªã‚»ãƒƒãƒˆ</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">resetChat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setMessages</span><span class="p">([])</span>
<span class="w">    </span><span class="nx">setThreadId</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
<span class="w">    </span><span class="nx">setError</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[])</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">messages</span><span class="p">,</span><span class="w">      </span><span class="c1">// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§</span>
<span class="w">    </span><span class="nx">isLoading</span><span class="p">,</span><span class="w">     </span><span class="c1">// é€ä¿¡ä¸­ã‹</span>
<span class="w">    </span><span class="nx">error</span><span class="p">,</span><span class="w">         </span><span class="c1">// ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">,</span><span class="w">   </span><span class="c1">// é€ä¿¡é–¢æ•°</span>
<span class="w">    </span><span class="nx">resetChat</span><span class="p">,</span><span class="w">     </span><span class="c1">// ãƒªã‚»ãƒƒãƒˆé–¢æ•°</span>
<span class="w">    </span><span class="nx">threadId</span><span class="p">,</span><span class="w">      </span><span class="c1">// ã‚¹ãƒ¬ãƒƒãƒ‰ID</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="usecallback-ã¨ã¯">useCallback ã¨ã¯ï¼Ÿ<a class="header-link" href="#usecallback-ã¨ã¯" title="Permanent link">&para;</a></h3>
<div class="info-box">
<h3>ğŸ”„ useCallback ã®å½¹å‰²</h3>
<p><strong>å•é¡Œ:</strong><br>
React ã¯å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ãŸã³ã«é–¢æ•°ã‚’æ–°ã—ãä½œã‚Šç›´ã™<br>
â†’ å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ¸¡ã™ã¨ã€æ¯å›ã€Œæ–°ã—ã„é–¢æ•°ã€ã¨åˆ¤æ–­ã•ã‚Œã‚‹<br>
â†’ ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒç™ºç”Ÿ</p>
<p><strong>è§£æ±º:</strong><br>
useCallback ã§é–¢æ•°ã‚’ãƒ¡ãƒ¢åŒ–ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰<br>
â†’ ä¾å­˜é…åˆ—ã®å€¤ãŒå¤‰ã‚ã‚‰ãªã„é™ã‚Šã€åŒã˜é–¢æ•°ã‚’å†åˆ©ç”¨</p>
<pre>
const sendMessage = useCallback(async (content) => {
  // å‡¦ç†
}, [threadId, isLoading, ...]);  // ã“ã®å€¤ãŒå¤‰ã‚ã£ãŸã‚‰æ–°ã—ã„é–¢æ•°ã‚’ä½œã‚‹
</pre>
<p>ğŸ’¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãŸã‚ã€‚ãªãã¦ã‚‚å‹•ããŒã€ã‚ã‚‹ã¨åŠ¹ç‡çš„ã€‚</p>
</div>

<h3 id="ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°è¡¨ç¤ºã®ä»•çµ„ã¿">ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°è¡¨ç¤ºã®ä»•çµ„ã¿<a class="header-link" href="#ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°è¡¨ç¤ºã®ä»•çµ„ã¿" title="Permanent link">&para;</a></h3>
<div class="flow-box">
<h3>ğŸ“¡ ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°è¡¨ç¤º</h3>
<pre>
[ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰]                        [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰]

sendMessage("ã“ã‚“ã«ã¡ã¯") â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶

content = ""              â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ "ã“"
content = "ã“"            â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ "ã‚“"
content = "ã“ã‚“"          â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ "ã«"
content = "ã“ã‚“ã«"        â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ "ã¡"
content = "ã“ã‚“ã«ã¡"      â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ "ã¯"
content = "ã“ã‚“ã«ã¡ã¯"    â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ "ï¼"
content = "ã“ã‚“ã«ã¡ã¯ï¼"  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [DONE]
</pre>
<p><strong>ç”»é¢:</strong><br>
ã€Œã“ã€â†’ã€Œã“ã‚“ã€â†’ã€Œã“ã‚“ã«ã€â†’ã€Œã“ã‚“ã«ã¡ã€â†’ã€Œã“ã‚“ã«ã¡ã¯ã€â†’ã€Œã“ã‚“ã«ã¡ã¯ï¼ã€</p>
<p>ğŸ’¡ onChunk ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ setMessages ã‚’å‘¼ã¶<br>
â†’ æ¯å›ç”»é¢ãŒæ›´æ–°ã•ã‚Œã‚‹<br>
â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ–‡å­—ãŒå¢—ãˆã¦ã„ãã®ã‚’è¦‹ã‚Œã‚‹ï¼</p>
</div>

<hr />
<h2 id="8-usesessionsts---ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®å®Œå…¨è§£èª¬">8. useSessions.ts - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®å®Œå…¨è§£èª¬<a class="header-link" href="#8-usesessionsts---ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®å®Œå…¨è§£èª¬" title="Permanent link">&para;</a></h2>
<p>è¤‡æ•°ã®ä¼šè©±ã‚’ç®¡ç†ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚</p>
<h3 id="ä¸»ãªæ©Ÿèƒ½">ä¸»ãªæ©Ÿèƒ½<a class="header-link" href="#ä¸»ãªæ©Ÿèƒ½" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>æ©Ÿèƒ½</th>
<th>èª¬æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ</td>
<td>æ–°ã—ã„ä¼šè©±ã‚’é–‹å§‹</td>
</tr>
<tr>
<td>ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆ</td>
<td>éå»ã®ä¼šè©±ã«æˆ»ã‚‹</td>
</tr>
<tr>
<td>ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤</td>
<td>ä¸è¦ãªä¼šè©±ã‚’å‰Šé™¤</td>
</tr>
<tr>
<td>è‡ªå‹•ä¿å­˜</td>
<td>ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜</td>
</tr>
<tr>
<td>ã‚¿ã‚¤ãƒˆãƒ«è‡ªå‹•ç”Ÿæˆ</td>
<td>æœ€åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ã‚¿ã‚¤ãƒˆãƒ«ã‚’ä½œæˆ</td>
</tr>
</tbody>
</table>
<h3 id="å®Œå…¨ãªã‚³ãƒ¼ãƒ‰_2">å®Œå…¨ãªã‚³ãƒ¼ãƒ‰<a class="header-link" href="#å®Œå…¨ãªã‚³ãƒ¼ãƒ‰_2" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ•ãƒƒã‚¯</span>
<span class="cm"> *</span>
<span class="cm"> * è¤‡æ•°ã®ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç®¡ç†ã—ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«æ°¸ç¶šåŒ–ã—ã¾ã™ã€‚</span>
<span class="cm"> *</span>
<span class="cm"> * ã€åˆ¶é™äº‹é …ã€‘</span>
<span class="cm"> * - æœ€å¤§10ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¾ã§ä¿å­˜ï¼ˆå®¹é‡åˆ¶é™ã®ãŸã‚ï¼‰</span>
<span class="cm"> * - ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ï¼ˆãƒ‡ãƒã‚¤ã‚¹é–“åŒæœŸãªã—ï¼‰</span>
<span class="cm"> */</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">useState</span><span class="p">,</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">,</span><span class="w"> </span><span class="nx">useEffect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;react&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Message</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./useChat&#39;</span>

<span class="cm">/** ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã‚­ãƒ¼ */</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">STORAGE_KEY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;chat_sessions&#39;</span>

<span class="cm">/**</span>
<span class="cm"> * æœ€å¤§ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°</span>
<span class="cm"> * - ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å®¹é‡åˆ¶é™ï¼ˆ5-10MBï¼‰ã‚’è€ƒæ…®</span>
<span class="cm"> * - 1ã‚»ãƒƒã‚·ãƒ§ãƒ³ç´„8KBï¼ˆ20ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æƒ³å®šï¼‰Ã— 10 = ç´„80KB</span>
<span class="cm"> */</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">MAX_SESSIONS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10</span>

<span class="cm">/** ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ« */</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">DEFAULT_SESSION_TITLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;æ–°ã—ã„ä¼šè©±&#39;</span>

<span class="cm">/**</span>
<span class="cm"> * ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å‹å®šç¾©</span>
<span class="cm"> */</span>
<span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">ChatSession</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w">            </span><span class="c1">// ä¸€æ„ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ID</span>
<span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w">         </span><span class="c1">// ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚¿ã‚¤ãƒˆãƒ«</span>
<span class="w">  </span><span class="nx">messages</span><span class="o">:</span><span class="w"> </span><span class="kt">Message</span><span class="p">[]</span><span class="w">   </span><span class="c1">// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´</span>
<span class="w">  </span><span class="nx">threadId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="w">  </span><span class="c1">// ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã®ä¼šè©±ã‚¹ãƒ¬ãƒƒãƒ‰ID</span>
<span class="w">  </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w">     </span><span class="c1">// ä½œæˆæ—¥æ™‚ï¼ˆUnix timestampï¼‰</span>
<span class="w">  </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w">     </span><span class="c1">// æœ€çµ‚æ›´æ–°æ—¥æ™‚</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ç”Ÿæˆ</span>
<span class="cm"> * å½¢å¼: session_{timestamp}_{ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—}</span>
<span class="cm"> */</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">generateSessionId</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="sb">`session_</span><span class="si">${</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="si">}</span><span class="sb">_</span><span class="si">${</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">().</span><span class="nx">toString</span><span class="p">(</span><span class="mf">36</span><span class="p">).</span><span class="nx">substr</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">9</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * æ–°ã—ã„ç©ºã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ</span>
<span class="cm"> */</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">createNewSession</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">ChatSession</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">generateSessionId</span><span class="p">(),</span>
<span class="w">    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">DEFAULT_SESSION_TITLE</span><span class="p">,</span>
<span class="w">    </span><span class="nx">messages</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<span class="w">    </span><span class="nx">threadId</span><span class="o">:</span><span class="w"> </span><span class="kt">null</span><span class="p">,</span>
<span class="w">    </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
<span class="w">    </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿</span>
<span class="cm"> */</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">loadSessionsFromStorage</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">ChatSession</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">stored</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">STORAGE_KEY</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">stored</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">stored</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ã‚¨ãƒ©ãƒ¼æ™‚ã¯ç©ºé…åˆ—ã‚’è¿”ã™ï¼ˆãƒ‡ãƒ¼ã‚¿ç ´ææ™‚ã®å®‰å…¨å¯¾ç­–ï¼‰</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">[]</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜</span>
<span class="cm"> */</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">saveSessionsToStorage</span><span class="p">(</span><span class="nx">sessions</span><span class="o">:</span><span class="w"> </span><span class="kt">ChatSession</span><span class="p">[])</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">STORAGE_KEY</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">sessions</span><span class="p">))</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// å®¹é‡è¶…éãªã©ã®ã‚¨ãƒ©ãƒ¼ã¯æ¡ã‚Šã¤ã¶ã™</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã‹ã‚‰ã‚¿ã‚¤ãƒˆãƒ«ã‚’ç”Ÿæˆ</span>
<span class="cm"> * - æœ€å¤§20æ–‡å­—ã¾ã§</span>
<span class="cm"> * - æ”¹è¡Œã¯ã‚¹ãƒšãƒ¼ã‚¹ã«å¤‰æ›</span>
<span class="cm"> */</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">generateTitleFromMessage</span><span class="p">(</span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">maxLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">trimmed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">content</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">trimmed</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">maxLength</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">trimmed</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">trimmed</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">maxLength</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;...&#39;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ•ãƒƒã‚¯</span>
<span class="cm"> */</span>
<span class="k">export</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">useSessions</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§</span>
<span class="w">  </span><span class="c1">// useState ã®åˆæœŸåŒ–é–¢æ•°ã‚’ä½¿ç”¨ï¼ˆåˆå›ã®ã¿å®Ÿè¡Œï¼‰</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">sessions</span><span class="p">,</span><span class="w"> </span><span class="nx">setSessions</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">ChatSession</span><span class="err">[]</span><span class="p">&gt;(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">loaded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loadSessionsFromStorage</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">loaded</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">[</span><span class="nx">createNewSession</span><span class="p">()]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">loaded</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="c1">// ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ID</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">activeSessionId</span><span class="p">,</span><span class="w"> </span><span class="nx">setActiveSessionId</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="p">&gt;(</span>
<span class="w">    </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">sessions</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">  </span><span class="p">)</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// ã‚»ãƒƒã‚·ãƒ§ãƒ³å¤‰æ›´æ™‚ã«è‡ªå‹•ä¿å­˜</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">saveSessionsToStorage</span><span class="p">(</span><span class="nx">sessions</span><span class="p">)</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">sessions</span><span class="p">])</span>

<span class="w">  </span><span class="c1">// ç¾åœ¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚»ãƒƒã‚·ãƒ§ãƒ³</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">activeSession</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sessions</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">activeSessionId</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">sessions</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">createSession</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">newSession</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createNewSession</span><span class="p">()</span>
<span class="w">    </span><span class="nx">setSessions</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">updated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">newSession</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">prev</span><span class="p">]</span><span class="w">  </span><span class="c1">// å…ˆé ­ã«è¿½åŠ </span>
<span class="w">      </span><span class="c1">// æœ€å¤§æ•°ã‚’è¶…ãˆãŸã‚‰å¤ã„ã‚‚ã®ã‚’å‰Šé™¤</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">updated</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">MAX_SESSIONS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">updated</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">MAX_SESSIONS</span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">updated</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="nx">setActiveSessionId</span><span class="p">(</span><span class="nx">newSession</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">newSession</span><span class="p">.</span><span class="nx">id</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[])</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’åˆ‡ã‚Šæ›¿ãˆ</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">switchSession</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">((</span><span class="nx">sessionId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setActiveSessionId</span><span class="p">(</span><span class="nx">sessionId</span><span class="p">)</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[])</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">closeSession</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">((</span><span class="nx">sessionId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setSessions</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">remainingSessions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prev</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">sessionId</span><span class="p">)</span>

<span class="w">      </span><span class="c1">// å…¨ã¦å‰Šé™¤ã•ã‚ŒãŸå ´åˆã¯æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">remainingSessions</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">newSession</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createNewSession</span><span class="p">()</span>
<span class="w">        </span><span class="nx">setActiveSessionId</span><span class="p">(</span><span class="nx">newSession</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="nx">newSession</span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="c1">// å‰Šé™¤ã•ã‚ŒãŸã®ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³ã ã£ãŸå ´åˆ</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sessionId</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">activeSessionId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">deletedIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prev</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">sessionId</span><span class="p">)</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">nextIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">deletedIndex</span><span class="p">,</span><span class="w"> </span><span class="nx">remainingSessions</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">        </span><span class="nx">setActiveSessionId</span><span class="p">(</span><span class="nx">remainingSessions</span><span class="p">[</span><span class="nx">nextIndex</span><span class="p">].</span><span class="nx">id</span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">remainingSessions</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">activeSessionId</span><span class="p">])</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›´æ–°</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">updateSessionMessages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useCallback</span><span class="p">((</span>
<span class="w">    </span><span class="nx">sessionId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="w">    </span><span class="nx">messages</span><span class="o">:</span><span class="w"> </span><span class="kt">Message</span><span class="p">[],</span>
<span class="w">    </span><span class="nx">threadId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">setSessions</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">prev</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">session</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">session</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">sessionId</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">session</span>

<span class="w">      </span><span class="c1">// ã‚¿ã‚¤ãƒˆãƒ«è‡ªå‹•ç”Ÿæˆï¼ˆã¾ã ã€Œæ–°ã—ã„ä¼šè©±ã€ã®å ´åˆã®ã¿ï¼‰</span>
<span class="w">      </span><span class="kd">let</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">session</span><span class="p">.</span><span class="nx">title</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">title</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">DEFAULT_SESSION_TITLE</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">messages</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">firstUserMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">messages</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">m</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">m</span><span class="p">.</span><span class="nx">role</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">firstUserMessage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateTitleFromMessage</span><span class="p">(</span><span class="nx">firstUserMessage</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">...</span><span class="nx">session</span><span class="p">,</span>
<span class="w">        </span><span class="nx">messages</span><span class="p">,</span>
<span class="w">        </span><span class="nx">threadId</span><span class="p">,</span>
<span class="w">        </span><span class="nx">title</span><span class="p">,</span>
<span class="w">        </span><span class="nx">updatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}))</span>
<span class="w">  </span><span class="p">},</span><span class="w"> </span><span class="p">[])</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">sessions</span><span class="p">,</span><span class="w">              </span><span class="c1">// ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§</span>
<span class="w">    </span><span class="nx">activeSession</span><span class="p">,</span><span class="w">         </span><span class="c1">// ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³</span>
<span class="w">    </span><span class="nx">activeSessionId</span><span class="p">,</span><span class="w">       </span><span class="c1">// ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ID</span>
<span class="w">    </span><span class="nx">createSession</span><span class="p">,</span><span class="w">         </span><span class="c1">// æ–°è¦ä½œæˆ</span>
<span class="w">    </span><span class="nx">switchSession</span><span class="p">,</span><span class="w">         </span><span class="c1">// åˆ‡ã‚Šæ›¿ãˆ</span>
<span class="w">    </span><span class="nx">closeSession</span><span class="p">,</span><span class="w">          </span><span class="c1">// å‰Šé™¤</span>
<span class="w">    </span><span class="nx">updateSessionMessages</span><span class="p">,</span><span class="w"> </span><span class="c1">// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ›´æ–°</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ä»•çµ„ã¿">ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ä»•çµ„ã¿<a class="header-link" href="#ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ä»•çµ„ã¿" title="Permanent link">&para;</a></h3>
<div class="info-box">
<h3>ğŸ’¾ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸</h3>
<p>ãƒ–ãƒ©ã‚¦ã‚¶ã«å†…è”µã•ã‚ŒãŸã€Œç°¡æ˜“ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€</p>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  localStorage                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ã‚­ãƒ¼           â”‚  å€¤                                          â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ chat_sessions   â”‚ [{"id":"session_123","title":"å¤©æ°—ã«ã¤ã„ã¦",â”‚  â”‚
â”‚  â”‚                 â”‚   "messages":[...]}, {...}]                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
<p><strong>ã€ç‰¹å¾´ã€‘</strong></p>
<ul>
<li>âœ… ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ã‚‚ãƒ‡ãƒ¼ã‚¿ãŒæ®‹ã‚‹</li>
<li>âœ… ç´„ 5-10MB ã¾ã§ä¿å­˜å¯èƒ½</li>
<li>âŒ ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã¨ã¯åŒæœŸã•ã‚Œãªã„</li>
<li>âŒ ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã§æ¶ˆãˆã‚‹</li>
</ul>
<p><strong>ã€ä½¿ã„æ–¹ã€‘</strong></p>
<pre>
localStorage.setItem('key', 'value')  // ä¿å­˜
localStorage.getItem('key')           // å–å¾—
localStorage.removeItem('key')        // å‰Šé™¤
</pre>
<p>âš ï¸ æ³¨æ„: æ–‡å­—åˆ—ã—ã‹ä¿å­˜ã§ããªã„<br>
â†’ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ JSON.stringify() ã§æ–‡å­—åˆ—ã«å¤‰æ›<br>
â†’ å–å¾—æ™‚ã¯ JSON.parse() ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«æˆ»ã™</p>
</div>

<hr />
<h2 id="9-apits---apié€šä¿¡ã®å®Œå…¨è§£èª¬">9. api.ts - APIé€šä¿¡ã®å®Œå…¨è§£èª¬<a class="header-link" href="#9-apits---apié€šä¿¡ã®å®Œå…¨è§£èª¬" title="Permanent link">&para;</a></h2>
<p>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã®é€šä¿¡ã‚’æ‹…å½“ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚</p>
<h3 id="å®Œå…¨ãªã‚³ãƒ¼ãƒ‰_3">å®Œå…¨ãªã‚³ãƒ¼ãƒ‰<a class="header-link" href="#å®Œå…¨ãªã‚³ãƒ¼ãƒ‰_3" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * APIé€šä¿¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«</span>
<span class="cm"> *</span>
<span class="cm"> * ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã¨ã®é€šä¿¡ã‚’è¡Œã„ã¾ã™ã€‚</span>
<span class="cm"> */</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">auth</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;./firebase&#39;</span>

<span class="c1">// APIãƒ™ãƒ¼ã‚¹URLï¼ˆç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ï¼‰</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">API_BASE_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VITE_API_BASE_URL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;http://localhost:8080&#39;</span>

<span class="cm">/**</span>
<span class="cm"> * èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—</span>
<span class="cm"> *</span>
<span class="cm"> * Firebase ã‹ã‚‰IDãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹ã€‚</span>
<span class="cm"> * ã“ã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¸ã®ã€Œèªè¨¼ã®è¨¼ã€ã«ãªã‚‹ã€‚</span>
<span class="cm"> */</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getAuthToken</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">string</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">auth</span><span class="p">.</span><span class="nx">currentUser</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">getIdToken</span><span class="p">()</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ç”Ÿæˆ</span>
<span class="cm"> *</span>
<span class="cm"> * HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ä»˜åŠ ã™ã‚‹ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½œæˆã€‚</span>
<span class="cm"> * Bearer ãƒˆãƒ¼ã‚¯ãƒ³å½¢å¼ã§èªè¨¼æƒ…å ±ã‚’é€ã‚‹ã€‚</span>
<span class="cm"> */</span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">createAuthHeaders</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">HeadersInit</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getAuthToken</span><span class="p">()</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;Authorization&#39;</span><span class="o">:</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">token</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w">  </span><span class="c1">// ã“ã‚ŒãŒèªè¨¼ã®è¨¼ï¼</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼‰</span>
<span class="cm"> *</span>
<span class="cm"> * @param message ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</span>
<span class="cm"> * @param threadId ã‚¹ãƒ¬ãƒƒãƒ‰IDï¼ˆçœç•¥å¯ï¼‰</span>
<span class="cm"> * @param onChunk ãƒãƒ£ãƒ³ã‚¯å—ä¿¡æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯</span>
<span class="cm"> * @returns ã‚¹ãƒ¬ãƒƒãƒ‰ID</span>
<span class="cm"> */</span>
<span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">sendChatMessage</span><span class="p">(</span>
<span class="w">  </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="w">  </span><span class="nx">threadId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">  </span><span class="nx">onChunk</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">chunk</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span>
<span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="p">&lt;</span><span class="nt">string</span><span class="p">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// Step 1: èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½œæˆ</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">createAuthHeaders</span><span class="p">()</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// Step 2: APIã«POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆ</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">API_BASE_URL</span><span class="si">}</span><span class="sb">/chat`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">headers</span><span class="p">,</span>
<span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
<span class="w">      </span><span class="nx">message</span><span class="p">,</span>
<span class="w">      </span><span class="nx">thread_id</span><span class="o">:</span><span class="w"> </span><span class="kt">threadId</span><span class="p">,</span>
<span class="w">    </span><span class="p">}),</span>
<span class="w">  </span><span class="p">})</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// Step 3: ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">error</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// Step 4: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ã‚¹ãƒ¬ãƒƒãƒ‰IDã‚’å–å¾—</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">newThreadId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;X-Thread-Id&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">threadId</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#39;</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// Step 5: Server-Sent Events ã‚’å‡¦ç†</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="o">?</span><span class="p">.</span><span class="nx">getReader</span><span class="p">()</span>
<span class="w">  </span><span class="c1">// stream: true ã§æ—¥æœ¬èªã®æ–‡å­—åŒ–ã‘ã‚’é˜²æ­¢</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">decoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">TextDecoder</span><span class="p">()</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">reader</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®èª­ã¿å–ã‚Šã«å¤±æ•—ã—ã¾ã—ãŸ&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="c1">// Step 6: ãƒãƒ£ãƒ³ã‚¯ã‚’èª­ã¿ç¶šã‘ã‚‹</span>
<span class="w">  </span><span class="c1">// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">done</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">read</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">done</span><span class="p">)</span><span class="w"> </span><span class="k">break</span>

<span class="w">    </span><span class="c1">// ãƒã‚¤ãƒŠãƒª â†’ ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">decoder</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">stream</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">text</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// å„è¡Œã‚’å‡¦ç†</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">lines</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;data: &#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">line</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">6</span><span class="p">)</span><span class="w">  </span><span class="c1">// &quot;data: &quot; ã‚’é™¤å»</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;[DONE]&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="k">break</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;[ERROR]&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">8</span><span class="p">))</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">onChunk</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w">  </span><span class="c1">// ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’å‘¼ã¶</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">newThreadId</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="sseserver-sent-eventsã®ä»•çµ„ã¿">SSEï¼ˆServer-Sent Eventsï¼‰ã®ä»•çµ„ã¿<a class="header-link" href="#sseserver-sent-eventsã®ä»•çµ„ã¿" title="Permanent link">&para;</a></h3>
<div class="info-box">
<h3>ğŸ“¡ Server-Sent Events (SSE)</h3>
<p><strong>ã€æ™®é€šã®HTTPé€šä¿¡ã€‘</strong></p>
<pre>
[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ] â”€â”€â”€â”€ãƒªã‚¯ã‚¨ã‚¹ãƒˆâ”€â”€â”€â”€â–¶ [ã‚µãƒ¼ãƒãƒ¼]
                                     â”‚
               ï¼ˆ3ç§’å¾…ã¡...ï¼‰        â”‚
                                     â–¼
[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ] â—€â”€â”€â”€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆå…¨éƒ¨ï¼‰â”€â”€ [ã‚µãƒ¼ãƒãƒ¼]
</pre>
<p><strong>ã€SSEã€‘</strong></p>
<pre>
[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ] â”€â”€â”€â”€ãƒªã‚¯ã‚¨ã‚¹ãƒˆâ”€â”€â”€â”€â–¶ [ã‚µãƒ¼ãƒãƒ¼]
[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ] â—€â”€â”€â”€"data: ã“"â”€â”€â”€â”€â”€ [ã‚µãƒ¼ãƒãƒ¼]
[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ] â—€â”€â”€â”€"data: ã‚“"â”€â”€â”€â”€â”€ [ã‚µãƒ¼ãƒãƒ¼]
[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ] â—€â”€â”€â”€"data: ã«"â”€â”€â”€â”€â”€ [ã‚µãƒ¼ãƒãƒ¼]
[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ] â—€â”€â”€â”€"data: ã¡"â”€â”€â”€â”€â”€ [ã‚µãƒ¼ãƒãƒ¼]
[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ] â—€â”€â”€â”€"data: ã¯"â”€â”€â”€â”€â”€ [ã‚µãƒ¼ãƒãƒ¼]
[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ] â—€â”€â”€â”€"data: [DONE]"â”€ [ã‚µãƒ¼ãƒãƒ¼]
</pre>
<p>â†’ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç”»é¢ã«æ–‡å­—ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼</p>
<p><strong>ã€SSEã®ãƒ‡ãƒ¼ã‚¿å½¢å¼ã€‘</strong></p>
<pre>
data: æ–‡å­—åˆ—\n
data: æ–‡å­—åˆ—\n
data: [DONE]\n
</pre>
<p>å„è¡ŒãŒ "data: " ã§å§‹ã¾ã‚‹<br>
æœ€å¾Œã¯ "[DONE]" ã§çµ‚äº†ã‚’çŸ¥ã‚‰ã›ã‚‹</p>
</div>

<h3 id="textdecoder-ã®é‡è¦æ€§">TextDecoder ã®é‡è¦æ€§<a class="header-link" href="#textdecoder-ã®é‡è¦æ€§" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// stream: true ãŒãªã„ã¨æ—¥æœ¬èªãŒæ–‡å­—åŒ–ã‘ã™ã‚‹ï¼</span>

<span class="c1">// æ‚ªã„ä¾‹</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">decoder</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span><span class="w">  </span><span class="c1">// âŒ æ—¥æœ¬èªãŒåŒ–ã‘ã‚‹å¯èƒ½æ€§</span>

<span class="c1">// è‰¯ã„ä¾‹</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">decoder</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">stream</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w"> </span><span class="p">});</span><span class="w">  </span><span class="c1">// âœ… æ­£ã—ãå‡¦ç†</span>

<span class="c1">// ãªãœï¼Ÿ</span>
<span class="c1">// UTF-8ã§ã¯æ—¥æœ¬èª1æ–‡å­— = 3ãƒã‚¤ãƒˆ</span>
<span class="c1">// ãƒãƒ£ãƒ³ã‚¯ã®å¢ƒç•Œã§åˆ†æ–­ã•ã‚Œã‚‹ã¨...</span>
<span class="c1">// ä¾‹: &quot;æ—¥&quot; = [E6, 97, A5]</span>
<span class="c1">//     ãƒãƒ£ãƒ³ã‚¯1: [E6, 97]  â† ä¸å®Œå…¨ï¼</span>
<span class="c1">//     ãƒãƒ£ãƒ³ã‚¯2: [A5, ...]</span>
<span class="c1">// stream: true ã§ä¸å®Œå…¨ãªãƒã‚¤ãƒˆã‚’ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã—ã¦ãã‚Œã‚‹</span>
</code></pre></div>

<hr />
<h2 id="10-firebasets---firebaseåˆæœŸåŒ–">10. firebase.ts - FirebaseåˆæœŸåŒ–<a class="header-link" href="#10-firebasets---firebaseåˆæœŸåŒ–" title="Permanent link">&para;</a></h2>
<p>Firebase SDKã®åˆæœŸåŒ–ã‚’è¡Œã†ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚</p>
<h3 id="å®Œå…¨ãªã‚³ãƒ¼ãƒ‰_4">å®Œå…¨ãªã‚³ãƒ¼ãƒ‰<a class="header-link" href="#å®Œå…¨ãªã‚³ãƒ¼ãƒ‰_4" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * FirebaseåˆæœŸåŒ–</span>
<span class="cm"> *</span>
<span class="cm"> * ã€è¨­å®šæ–¹æ³•ã€‘</span>
<span class="cm"> * .envãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦ãã ã•ã„:</span>
<span class="cm"> * - VITE_FIREBASE_API_KEY</span>
<span class="cm"> * - VITE_FIREBASE_AUTH_DOMAIN</span>
<span class="cm"> * - VITE_FIREBASE_PROJECT_ID</span>
<span class="cm"> */</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">initializeApp</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;firebase/app&#39;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">getAuth</span><span class="p">,</span><span class="w"> </span><span class="nx">GoogleAuthProvider</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;firebase/auth&#39;</span>

<span class="c1">// Firebaseè¨­å®šï¼ˆç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ï¼‰</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">firebaseConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">apiKey</span><span class="o">:</span><span class="w"> </span><span class="kt">import.meta.env.VITE_FIREBASE_API_KEY</span><span class="p">,</span>
<span class="w">  </span><span class="nx">authDomain</span><span class="o">:</span><span class="w"> </span><span class="kt">import.meta.env.VITE_FIREBASE_AUTH_DOMAIN</span><span class="p">,</span>
<span class="w">  </span><span class="nx">projectId</span><span class="o">:</span><span class="w"> </span><span class="kt">import.meta.env.VITE_FIREBASE_PROJECT_ID</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// FirebaseåˆæœŸåŒ–</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">initializeApp</span><span class="p">(</span><span class="nx">firebaseConfig</span><span class="p">)</span>

<span class="c1">// èªè¨¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">auth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getAuth</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>

<span class="c1">// Googleãƒ­ã‚°ã‚¤ãƒ³ãƒ—ãƒ­ãƒã‚¤ãƒ€</span>
<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">googleProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">GoogleAuthProvider</span><span class="p">()</span>
</code></pre></div>

<h3 id="ç’°å¢ƒå¤‰æ•°ã«ã¤ã„ã¦">ç’°å¢ƒå¤‰æ•°ã«ã¤ã„ã¦<a class="header-link" href="#ç’°å¢ƒå¤‰æ•°ã«ã¤ã„ã¦" title="Permanent link">&para;</a></h3>
<div class="info-box">
<h3>ğŸ” ç’°å¢ƒå¤‰æ•°ã¨ Vite</h3>
<p><strong>ã€.envãƒ•ã‚¡ã‚¤ãƒ«ã€‘</strong></p>
<pre>
frontend/.env
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VITE_FIREBASE_API_KEY=AIza...                                        â”‚
â”‚ VITE_FIREBASE_AUTH_DOMAIN=your-project.firebaseapp.com              â”‚
â”‚ VITE_FIREBASE_PROJECT_ID=your-project-id                            â”‚
â”‚ VITE_API_BASE_URL=https://your-api.run.app                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
<p><strong>ã€Viteã§ã®ç’°å¢ƒå¤‰æ•°ã®ãƒ«ãƒ¼ãƒ«ã€‘</strong></p>
<ul>
<li>âœ… VITE_ ã§å§‹ã¾ã‚‹å¤‰æ•°ã ã‘ãŒãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ä½¿ãˆã‚‹</li>
<li>âœ… import.meta.env.VITE_XXX ã§ã‚¢ã‚¯ã‚»ã‚¹</li>
<li>âŒ VITE_ ãŒãªã„å¤‰æ•°ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰</li>
</ul>
<p><strong>ã€ãªãœç’°å¢ƒå¤‰æ•°ã‚’ä½¿ã†ï¼Ÿã€‘</strong></p>
<ol>
<li>ç§˜å¯†æƒ…å ±ã‚’ã‚³ãƒ¼ãƒ‰ã«ç›´æ›¸ãã—ãªã„</li>
<li>é–‹ç™º/æœ¬ç•ªã§è¨­å®šã‚’åˆ‡ã‚Šæ›¿ãˆã‚„ã™ã„</li>
<li>.gitignore ã§ .env ã‚’é™¤å¤– â†’ Gitã«ç§˜å¯†æƒ…å ±ãŒå…¥ã‚‰ãªã„</li>
</ol>
<p>âš ï¸ æ³¨æ„: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ç’°å¢ƒå¤‰æ•°ã¯çµå±€ãƒ–ãƒ©ã‚¦ã‚¶ã«é€ã‚‰ã‚Œã‚‹<br>
â†’ æœ¬å½“ã®ç§˜å¯†ï¼ˆAPIã‚­ãƒ¼ãªã©ï¼‰ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ç½®ã</p>
</div>

<hr />
<h2 id="11-typescriptã®å‹ã‚·ã‚¹ãƒ†ãƒ ">11. TypeScriptã®å‹ã‚·ã‚¹ãƒ†ãƒ <a class="header-link" href="#11-typescriptã®å‹ã‚·ã‚¹ãƒ†ãƒ " title="Permanent link">&para;</a></h2>
<p>TypeScriptã¯JavaScriptã«ã€Œå‹ã€ã‚’è¿½åŠ ã—ãŸè¨€èªã§ã™ã€‚<br />
é–“é•ã„ã‚’äº‹å‰ã«é˜²ã’ã‚‹ï¼</p>
<h3 id="åŸºæœ¬çš„ãªå‹">åŸºæœ¬çš„ãªå‹<a class="header-link" href="#åŸºæœ¬çš„ãªå‹" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;å¤ªéƒ&quot;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">25</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">isActive</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="c1">// é…åˆ—</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">numbers</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">];</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">names</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Bob&quot;</span><span class="p">];</span>

<span class="c1">// ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‹</span>
<span class="kr">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;å¤ªéƒ&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;taro@example.com&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="c1">// user.age = 25;  // âŒ ã‚¨ãƒ©ãƒ¼ï¼Userå‹ã«ageã¯ãªã„</span>
</code></pre></div>

<h3 id="interface-ã¨-type">interface ã¨ type<a class="header-link" href="#interface-ã¨-type" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// interface: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å½¢ã‚’å®šç¾©</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">Message</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;assistant&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// ãƒªãƒ†ãƒ©ãƒ«å‹ï¼ˆã“ã®2ã¤ã ã‘è¨±å¯ï¼‰</span>
<span class="w">  </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// type: ä»»æ„ã®å‹ã‚’å®šç¾©</span>
<span class="kr">type</span><span class="w"> </span><span class="nx">MessageRole</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;assistant&#39;</span><span class="p">;</span>

<span class="c1">// ã©ã¡ã‚‰ã‚’ä½¿ã†ï¼Ÿ</span>
<span class="c1">// â†’ åŸºæœ¬çš„ã«ã©ã¡ã‚‰ã§ã‚‚OK</span>
<span class="c1">// â†’ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ interface ãŒä¸€èˆ¬çš„</span>
<span class="c1">// â†’ è¤‡é›‘ãªå‹ã‚„ Union ã¯ type ãŒä¾¿åˆ©</span>
</code></pre></div>

<h3 id="unionå‹ã¨optional">Unionå‹ã¨Optional<a class="header-link" href="#unionå‹ã¨optional" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// Unionå‹: è¤‡æ•°ã®å‹ã®ã©ã‚Œã‹</span>
<span class="kr">type</span><span class="w"> </span><span class="nx">Status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;loading&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;success&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="p">;</span>

<span class="kd">let</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">Status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;loading&#39;</span><span class="p">;</span>
<span class="nx">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;success&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">// âœ… OK</span>
<span class="c1">// status = &#39;pending&#39;;  // âŒ ã‚¨ãƒ©ãƒ¼ï¼</span>

<span class="c1">// Optionalï¼ˆçœç•¥å¯èƒ½ï¼‰</span>
<span class="kd">interface</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">email?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">  </span><span class="c1">// ? ã§çœç•¥å¯èƒ½ã«</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">user1</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;å¤ªéƒ&quot;</span><span class="w"> </span><span class="p">};</span><span class="w">  </span><span class="c1">// âœ… emailãªã—ã§ã‚‚OK</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">user2</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;èŠ±å­&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;hanako@example.com&quot;</span><span class="w"> </span><span class="p">};</span><span class="w">  </span><span class="c1">// âœ…</span>
</code></pre></div>

<h3 id="ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹">ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹<a class="header-link" href="#ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹: å‹ã‚’å¼•æ•°ã®ã‚ˆã†ã«æ¸¡ã›ã‚‹</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;(</span><span class="nx">initialValue</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">T</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// ä½¿ã†ã¨ã</span>
<span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">setCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">number</span><span class="p">&gt;(</span><span class="mf">0</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">setName</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="p">&gt;(</span><span class="s2">&quot;å¤ªéƒ&quot;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">setUser</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">&lt;</span><span class="nt">User</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>

<span class="c1">// &lt;T&gt; ã¯ã€Œå‹å¼•æ•°ã€</span>
<span class="c1">// å‘¼ã³å‡ºã—å´ãŒå…·ä½“çš„ãªå‹ã‚’æŒ‡å®šã§ãã‚‹</span>
</code></pre></div>

<div class="tip-box">
<h3>ğŸ’¡ TypeScript ã®ãƒ¡ãƒªãƒƒãƒˆ</h3>
<ol>
<li><strong>è£œå®ŒãŒåŠ¹ã</strong><br>user. ã¨æ‰“ã¤ã¨ id, name, email ãŒå€™è£œã«å‡ºã‚‹ï¼</li>
<li><strong>é–“é•ã„ã‚’äº‹å‰ã«ç™ºè¦‹</strong><br>message.rolr ã¨æ‰“ã¤ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆrole ã®typoï¼‰</li>
<li><strong>ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ãŒå®‰å…¨</strong><br>é–¢æ•°åã‚„å‹ã‚’å¤‰ãˆã‚‹ã¨ã€å½±éŸ¿ç®‡æ‰€ãŒå…¨ã¦åˆ†ã‹ã‚‹</li>
<li><strong>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä»£ã‚ã‚Š</strong><br>å‹å®šç¾©ã‚’è¦‹ã‚Œã°ã€ä½•ãŒå¿…è¦ã‹åˆ†ã‹ã‚‹</li>
</ol>
<p>âš ï¸ æ³¨æ„: å®Ÿè¡Œæ™‚ã«ã¯å‹æƒ…å ±ã¯æ¶ˆãˆã‚‹<br>
â†’ å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼ã¯é˜²ã’ãªã„ï¼ˆã‚ãã¾ã§é–‹ç™ºæ™‚ã®ãƒã‚§ãƒƒã‚¯ï¼‰</p>
</div>

<hr />
<h2 id="12-å…¨ä½“ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼">12. å…¨ä½“ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼<a class="header-link" href="#12-å…¨ä½“ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼" title="Permanent link">&para;</a></h2>
<p>ã™ã¹ã¦ã®ã‚³ãƒ¼ãƒ‰ãŒã©ã†é€£æºã™ã‚‹ã‹ã€å…¨ä½“åƒã‚’æŠŠæ¡ã—ã¾ã—ã‚‡ã†ã€‚</p>
<div class="flow-box">
<h3>ğŸ”„ ãƒãƒ£ãƒƒãƒˆé€ä¿¡ã®å®Œå…¨ãƒ•ãƒ­ãƒ¼</h3>
<pre>
[ãƒ¦ãƒ¼ã‚¶ãƒ¼] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›
    â”‚
    â–¼
[ChatScreen] onSendMessage(text) å‘¼ã³å‡ºã—
    â”‚
    â–¼
[useChat] sendMessage(content)
    â”‚
    â”œâ”€â”€ setMessages([...messages, userMessage])  â† ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 
    â”‚
    â”œâ”€â”€ setMessages([..., assistantMessage])  â† ç©ºã®AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 
    â”‚
    â–¼
[api.ts] sendChatMessage(content, threadId, onChunk)
    â”‚
    â”œâ”€â”€ getAuthToken()  â† IDãƒˆãƒ¼ã‚¯ãƒ³å–å¾—
    â”‚
    â”œâ”€â”€ fetch('/chat', { headers: { Authorization: 'Bearer ...' } })
    â”‚
    â–¼
[ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚  ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
    â”‚  ãƒ»AI ã«å•ã„åˆã‚ã›
    â”‚  ãƒ»ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã§è¿”ç­”
â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â–¼
[api.ts] reader.read() ã§ãƒãƒ£ãƒ³ã‚¯ã‚’å—ä¿¡
    â”‚
    â”œâ”€â”€ onChunk("ã“") â†’ setMessages æ›´æ–°
    â”œâ”€â”€ onChunk("ã‚“") â†’ setMessages æ›´æ–°
    â”œâ”€â”€ onChunk("ã«") â†’ setMessages æ›´æ–°
    â”œâ”€â”€ ...
    â”œâ”€â”€ onChunk("[DONE]") â†’ çµ‚äº†
    â”‚
    â–¼
[useChat] â†’ [useSessions] updateSessionMessages()
    â”‚
    â–¼
[useSessions] â†’ localStorage ã«ä¿å­˜
</pre>
</div>

<hr />
<h2 id="ã¾ã¨ã‚">ã¾ã¨ã‚<a class="header-link" href="#ã¾ã¨ã‚" title="Permanent link">&para;</a></h2>
<div class="summary-box">
<h3>ğŸ“ ã“ã®ç« ã§å­¦ã‚“ã ã“ã¨</h3>
<table>
<tr><th>æ¦‚å¿µ</th><th>ãƒã‚¤ãƒ³ãƒˆ</th></tr>
<tr><td>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</td><td>ç”»é¢ã®ãƒ‘ãƒ¼ãƒ„ã€‚çµ„ã¿åˆã‚ã›ã¦UIã‚’ä½œã‚‹</td></tr>
<tr><td>useState</td><td>çŠ¶æ…‹ã‚’æŒã¤ã€‚å¤‰æ›´ã™ã‚‹ã¨å†æç”»ã•ã‚Œã‚‹</td></tr>
<tr><td>useEffect</td><td>å‰¯ä½œç”¨ã‚’å®Ÿè¡Œã€‚ãƒã‚¦ãƒ³ãƒˆæ™‚ã‚„ãƒ‡ãƒ¼ã‚¿å¤‰æ›´æ™‚ã«å‡¦ç†</td></tr>
<tr><td>ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯</td><td>ãƒ­ã‚¸ãƒƒã‚¯ã‚’å†åˆ©ç”¨ã€‚useAuth, useChatãªã©</td></tr>
<tr><td>TypeScript</td><td>å‹ã§å®‰å…¨ã«ã€‚é–“é•ã„ã‚’äº‹å‰ã«é˜²ã</td></tr>
<tr><td>SSE</td><td>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹</td></tr>
</table>
<ul>
<li>âœ… useAuth: Firebaseèªè¨¼ã®çŠ¶æ…‹ç®¡ç†</li>
<li>âœ… useChat: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡ã¨ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†</li>
<li>âœ… useSessions: è¤‡æ•°ä¼šè©±ã®ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜</li>
<li>âœ… api.ts: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã®HTTPé€šä¿¡</li>
</ul>
</div>

<hr />
<h2 id="æ¬¡ã«èª­ã‚€ã¹ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ">æ¬¡ã«èª­ã‚€ã¹ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ<a class="header-link" href="#æ¬¡ã«èª­ã‚€ã¹ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>é †ç•ª</th>
<th>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</th>
<th>å†…å®¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><a href="./05_ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®æµã‚Œ.md">05_ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®æµã‚Œ.md</a></td>
<td>ç’°å¢ƒæ§‹ç¯‰ã®æ‰‹é †</td>
</tr>
<tr>
<td>2</td>
<td><a href="./11_ãƒãƒ£ãƒƒãƒˆé€ä¿¡ã®æµã‚Œ.md">11_ãƒãƒ£ãƒƒãƒˆé€ä¿¡ã®æµã‚Œ.md</a></td>
<td>è©³ç´°ãªãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼</td>
</tr>
<tr>
<td>3</td>
<td><a href="./12_ãƒ­ã‚°ã‚¤ãƒ³ã®æµã‚Œ.md">12_ãƒ­ã‚°ã‚¤ãƒ³ã®æµã‚Œ.md</a></td>
<td>èªè¨¼ãƒ•ãƒ­ãƒ¼ã®è©³ç´°</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="ç·´ç¿’å•é¡Œ">ç·´ç¿’å•é¡Œ<a class="header-link" href="#ç·´ç¿’å•é¡Œ" title="Permanent link">&para;</a></h2>
<h3 id="q1-usestate-ã«ã¤ã„ã¦">Q1: useState ã«ã¤ã„ã¦<a class="header-link" href="#q1-usestate-ã«ã¤ã„ã¦" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">setCount</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>

<span class="c1">// ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§ count ã¯ä½•ã«ãªã‚‹ï¼Ÿ</span>
<span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>

<span class="c1">// A. 3</span>
<span class="c1">// B. 1</span>
<span class="c1">// C. 0</span>
</code></pre></div>

<details>
<summary>ç­”ãˆã‚’è¦‹ã‚‹</summary>

**ç­”ãˆ: B. 1**

ç†ç”±: setCount ã¯éåŒæœŸçš„ã«æ›´æ–°ã•ã‚Œã‚‹ãŸã‚ã€3å›å‘¼ã‚“ã§ã‚‚å…¨ã¦ `0 + 1 = 1` ã«ãªã‚‹ã€‚

é€£ç¶šã—ã¦åŠ ç®—ã—ãŸã„å ´åˆã¯:

<div class="codehilite"><pre><span></span><code><span class="nx">setCount</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="nx">setCount</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="nx">setCount</span><span class="p">(</span><span class="nx">prev</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">prev</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="c1">// â†’ 3 ã«ãªã‚‹</span>
</code></pre></div>



</details>

<h3 id="q2-useeffect-ã®ä¾å­˜é…åˆ—">Q2: useEffect ã®ä¾å­˜é…åˆ—<a class="header-link" href="#q2-useeffect-ã®ä¾å­˜é…åˆ—" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;å®Ÿè¡Œã•ã‚Œã¾ã—ãŸ&quot;</span><span class="p">);</span>
<span class="p">},</span><span class="w"> </span><span class="p">[</span><span class="nx">userId</span><span class="p">]);</span>
</code></pre></div>

<p>ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã„ã¤å®Ÿè¡Œã•ã‚Œã‚‹ï¼Ÿ</p>
<details>
<summary>ç­”ãˆã‚’è¦‹ã‚‹</summary>

**ç­”ãˆ:**
1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæœ€åˆã«è¡¨ç¤ºã•ã‚ŒãŸã¨ãï¼ˆãƒã‚¦ãƒ³ãƒˆæ™‚ï¼‰
2. `userId` ã®å€¤ãŒå¤‰ã‚ã£ãŸã¨ã

`userId` ãŒåŒã˜å€¤ã®ã¾ã¾ãªã‚‰ã€å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦ã‚‚å®Ÿè¡Œã•ã‚Œãªã„ã€‚

</details>

<h3 id="q3-typescript-ã®å‹ã‚¨ãƒ©ãƒ¼">Q3: TypeScript ã®å‹ã‚¨ãƒ©ãƒ¼<a class="header-link" href="#q3-typescript-ã®å‹ã‚¨ãƒ©ãƒ¼" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kd">interface</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;å¤ªéƒ&quot;</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>

<p>ã“ã®ã‚³ãƒ¼ãƒ‰ã«ã¯ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚ä½•ãŒå•é¡Œï¼Ÿ</p>
<details>
<summary>ç­”ãˆã‚’è¦‹ã‚‹</summary>

**ç­”ãˆ:** `id` ã®å‹ãŒé•ã†

`id` ã¯ `string` å‹ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŒã€`1`ï¼ˆnumberï¼‰ã‚’æ¸¡ã—ã¦ã„ã‚‹ã€‚

æ­£ã—ãã¯:

<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="kt">User</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// æ–‡å­—åˆ—ã«ã™ã‚‹</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;å¤ªéƒ&quot;</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>



</details>
      </article>
      <footer class="footer">
        GCP AI Agent è¨­è¨ˆè³‡æ–™ | Built with Python & Markdown
      </footer>
    </main>
  </div>

  <script>
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
    }

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', function(e) {
      const sidebar = document.getElementById('sidebar');
      const toggle = document.querySelector('.menu-toggle');
      if (!sidebar.contains(e.target) && !toggle.contains(e.target)) {
        sidebar.classList.remove('open');
      }
    });
  </script>
</body>
</html>