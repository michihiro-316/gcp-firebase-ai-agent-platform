<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>03 ä»˜éŒ² agent.pyã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º - GCP AI Agent è¨­è¨ˆè³‡æ–™</title>
  <link rel="stylesheet" href="assets/style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“š</text></svg>">
</head>
<body>
  <header class="header">
    <a href="index.html" class="header-logo">
      <span>ğŸ“š</span>
      <span>GCP AI Agent è¨­è¨ˆè³‡æ–™</span>
    </a>
    <nav class="header-nav">
      <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
      <a href="02_å…¨ä½“åƒ.html">å…¨ä½“åƒ</a>
      <a href="https://github.com" target="_blank">GitHub</a>
    </nav>
    <button class="menu-toggle" onclick="toggleSidebar()">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </header>

  <div class="layout">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">ğŸ“– ã¯ã˜ã‚ã«</div>
        <ul class="sidebar-nav">
          <li><a href="01_ã¯ã˜ã‚ã«èª­ã‚“ã§ãã ã•ã„.html" >ã¯ã˜ã‚ã«èª­ã‚“ã§ãã ã•ã„</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">ğŸ—ï¸ ä»•çµ„ã¿ã‚’ç†è§£</div>
        <ul class="sidebar-nav">
          <li><a href="02_å…¨ä½“åƒ.html" >å…¨ä½“åƒ</a></li>
          <li><a href="03_ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è§£èª¬.html" class="active">ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è§£èª¬</a></li>
          <li><a href="04_ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è§£èª¬.html" >ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è§£èª¬</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">ğŸ› ï¸ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</div>
        <ul class="sidebar-nav">
          <li><a href="05_ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®æµã‚Œ.html" >ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®æµã‚Œ</a></li>
          <li><a href="06_ã‚³ãƒãƒ³ãƒ‰è§£èª¬.html" >ã‚³ãƒãƒ³ãƒ‰è§£èª¬</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">ğŸš€ å‹•ã‹ã™</div>
        <ul class="sidebar-nav">
          <li><a href="07_å‹•ã‹ã—ã¦ã¿ã‚ˆã†.html" >å‹•ã‹ã—ã¦ã¿ã‚ˆã†</a></li>
          <li><a href="08_AIã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º.html" >AIã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">ğŸ”§ ä¸Šç´šç·¨</div>
        <ul class="sidebar-nav">
          <li><a href="10_Gatewayã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£.html" >Gatewayã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">ğŸ”„ å‚è€ƒ: ãƒ•ãƒ­ãƒ¼è§£èª¬</div>
        <ul class="sidebar-nav">
          <li><a href="11_ãƒãƒ£ãƒƒãƒˆé€ä¿¡ã®æµã‚Œ.html" >ãƒãƒ£ãƒƒãƒˆé€ä¿¡ã®æµã‚Œ</a></li>
          <li><a href="12_ãƒ­ã‚°ã‚¤ãƒ³ã®æµã‚Œ.html" >ãƒ­ã‚°ã‚¤ãƒ³ã®æµã‚Œ</a></li>
          <li><a href="13_ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®æµã‚Œ.html" >ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®æµã‚Œ</a></li>
        </ul>
      </div>
    </aside>

    <main class="main">
      <article class="content">
        <h1 id="ä»˜éŒ²-agentpy-ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚¬ã‚¤ãƒ‰">ä»˜éŒ²: agent.py ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚¬ã‚¤ãƒ‰<a class="header-link" href="#ä»˜éŒ²-agentpy-ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚¬ã‚¤ãƒ‰" title="Permanent link">&para;</a></h1>
<div class="goal-box">
<div class="box-title">ğŸ¯ ã“ã®ãƒšãƒ¼ã‚¸ã®ã‚´ãƒ¼ãƒ«</div>
<div class="box-content">

agent.py ã‚’å®‰å…¨ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã‚‹ã‚ˆã†ã«ãªã‚‹

</div>
</div>

<hr />
<h2 id="ã“ã‚Œã ã‘ã¯å®ˆã‚Œ3ã¤ã®ãƒ«ãƒ¼ãƒ«">ã“ã‚Œã ã‘ã¯å®ˆã‚Œï¼3ã¤ã®ãƒ«ãƒ¼ãƒ«<a class="header-link" href="#ã“ã‚Œã ã‘ã¯å®ˆã‚Œ3ã¤ã®ãƒ«ãƒ¼ãƒ«" title="Permanent link">&para;</a></h2>
<div class="warning-box">
<div class="box-title">ğŸš¨ çµ¶å¯¾ã«å®ˆã‚‹ã“ã¨</div>
<div class="box-content">

### ãƒ«ãƒ¼ãƒ«1: BaseAgent ã‚’ç¶™æ‰¿ã™ã‚‹


<pre class="codehilite"><code class="language-python"># âœ… æ­£ã—ã„
class MyAgent(BaseAgent):
    pass

# âŒ ãƒ€ãƒ¡ï¼ˆç¶™æ‰¿ã‚’å¤–ã™ã¨å‹•ã‹ãªã„ï¼‰
class MyAgent:
    pass
</code></pre>



### ãƒ«ãƒ¼ãƒ«2: create_graph() ã¯ StateGraph ã‚’è¿”ã™


<pre class="codehilite"><code class="language-python">def create_graph(self) -&gt; StateGraph:
    graph = StateGraph(AgentState)
    graph.add_node(&quot;chat&quot;, self._chat_node)
    graph.set_entry_point(&quot;chat&quot;)
    graph.add_edge(&quot;chat&quot;, END)
    return graph  # â† StateGraph ã‚’è¿”ã™
</code></pre>



### ãƒ«ãƒ¼ãƒ«3: _chat_node() ã¯ {"messages": [...]} ã‚’è¿”ã™


<pre class="codehilite"><code class="language-python">async def _chat_node(self, state: AgentState) -&gt; dict:
    # ... å‡¦ç† ...
    response = await self.llm.ainvoke(messages)
    return {&quot;messages&quot;: [response]}  # â† ã“ã®å½¢å¼ã§è¿”ã™
</code></pre>



</div>
</div>

<hr />
<h2 id="è‡ªç”±ã«å¤‰ãˆã¦ã„ã„ã¨ã“ã‚">è‡ªç”±ã«å¤‰ãˆã¦ã„ã„ã¨ã“ã‚<a class="header-link" href="#è‡ªç”±ã«å¤‰ãˆã¦ã„ã„ã¨ã“ã‚" title="Permanent link">&para;</a></h2>
<div class="tip-box">
<div class="box-title">âœ… ç·¨é›†OK</div>
<div class="box-content">

| é …ç›® | å ´æ‰€ | å¤‰æ›´ã™ã‚‹ã¨ã©ã†ãªã‚‹ |
|------|------|------------------|
| AIã®æ€§æ ¼ | `SYSTEM_PROMPT` | è©±ã—æ–¹ãƒ»å½¹å‰²ãŒå¤‰ã‚ã‚‹ |
| AIãƒ¢ãƒ‡ãƒ« | `MODEL_NAME` | é€Ÿåº¦ãƒ»ã‚³ã‚¹ãƒˆãƒ»ç²¾åº¦ãŒå¤‰ã‚ã‚‹ |
| è¨˜æ†¶åŠ› | `MAX_HISTORY_MESSAGES` | ä¼šè©±ã®è¨˜æ†¶é‡ãŒå¤‰ã‚ã‚‹ |

### ä¾‹: é–¢è¥¿å¼ã®AIã«ã™ã‚‹


<pre class="codehilite"><code class="language-python">SYSTEM_PROMPT = &quot;&quot;&quot;ã‚ãªãŸã¯é–¢è¥¿å¼ã§è©±ã™AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚„ã§ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã«ç­”ãˆã¦ãªã€‚
ã€Œã‚„ã§ã€ã€Œã‚„ã‚“ã€ã€Œãªã‚“ã§ã‚„ã­ã‚“ã€ã‚’ä½¿ã£ã¦ãªã€‚&quot;&quot;&quot;
</code></pre>



### ä¾‹: ãƒ¢ãƒ‡ãƒ«ã‚’å¤‰ãˆã‚‹


<pre class="codehilite"><code class="language-python"># é€Ÿã„ãƒ»å®‰ã„
MODEL_NAME = &quot;gemini-1.5-flash&quot;

# è³¢ã„ãƒ»é«˜ã„
MODEL_NAME = &quot;gemini-1.5-pro&quot;
</code></pre>



</div>
</div>

<hr />
<h2 id="å…¨ä½“ã®æ§‹é€ å›³è§£">å…¨ä½“ã®æ§‹é€ ï¼ˆå›³è§£ï¼‰<a class="header-link" href="#å…¨ä½“ã®æ§‹é€ å›³è§£" title="Permanent link">&para;</a></h2>
<div class="info-box">
<div class="box-title">ğŸ—ï¸ agent.py ã®æ§‹é€ </div>
<div class="box-content">


<pre class="codehilite"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  agent.py                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ã€è‡ªç”±ã«ç·¨é›†OKã€‘                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ SYSTEM_PROMPT = &quot;...&quot;   â† AIã®æ€§æ ¼               â”‚ â”‚
â”‚  â”‚ MODEL_NAME = &quot;...&quot;      â† ä½¿ã†ãƒ¢ãƒ‡ãƒ«             â”‚ â”‚
â”‚  â”‚ MAX_HISTORY_MESSAGES    â† è¨˜æ†¶ã™ã‚‹ä¼šè©±æ•°         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  ã€è§¦ã‚‰ãªã„æ–¹ãŒã„ã„ã€‘                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ class XxxAgent(BaseAgent):  â† ç¶™æ‰¿ã¯å¤–ã•ãªã„     â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚ def create_graph(self):                          â”‚ â”‚
â”‚  â”‚     return StateGraph(...)  â† StateGraph ã‚’è¿”ã™  â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚ async def _chat_node(self, state):               â”‚ â”‚
â”‚  â”‚     return {&quot;messages&quot;: [...]}  â† ã“ã®å½¢å¼ã§è¿”ã™ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>



</div>
</div>

<hr />
<h2 id="ã‚ˆãã‚ã‚‹è³ªå•">ã‚ˆãã‚ã‚‹è³ªå•<a class="header-link" href="#ã‚ˆãã‚ã‚‹è³ªå•" title="Permanent link">&para;</a></h2>
<div class="info-box">
<div class="box-title">â“ FAQ</div>
<div class="box-content">

**Q: å£Šã—ã¦ã—ã¾ã£ãŸã‚‰ï¼Ÿ**


<pre class="codehilite"><code class="language-bash">git checkout agent.py
</code></pre>


ã§å…ƒã«æˆ»ã›ã¾ã™ã€‚

**Q: æ–°ã—ã„é¡§å®¢ç”¨ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½œã‚ŠãŸã„**


<pre class="codehilite"><code class="language-bash">cp -r _template acme-corp
</code></pre>


ã§ã‚³ãƒ”ãƒ¼ã—ã¦ã€`acme-corp/agent.py` ã‚’ç·¨é›†ã€‚

**Q: ã‚‚ã£ã¨è¤‡é›‘ãªã“ã¨ãŒã—ãŸã„ï¼ˆãƒ„ãƒ¼ãƒ«ä½¿ç”¨ã€æ¡ä»¶åˆ†å²ï¼‰**

â†’ [LangGraphå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://langchain-ai.github.io/langgraph/) ã‚’å‚ç…§

</div>
</div>

<hr />
<h2 id="ã¾ã¨ã‚">ã¾ã¨ã‚<a class="header-link" href="#ã¾ã¨ã‚" title="Permanent link">&para;</a></h2>
<div class="summary-box">
<div class="box-title">ğŸ“ è¦šãˆã‚‹ã“ã¨</div>
<div class="box-content">

| ã‚„ã‚‹ã“ã¨ | ã‚„ã‚Šæ–¹ |
|----------|--------|
| AIã®æ€§æ ¼ã‚’å¤‰ãˆã‚‹ | `SYSTEM_PROMPT` ã‚’ç·¨é›† |
| ãƒ¢ãƒ‡ãƒ«ã‚’å¤‰ãˆã‚‹ | `MODEL_NAME` ã‚’ç·¨é›† |
| è¨˜æ†¶åŠ›ã‚’å¤‰ãˆã‚‹ | `MAX_HISTORY_MESSAGES` ã‚’ç·¨é›† |
| å£Šã—ãŸã‚‰ | `git checkout agent.py` |

**â†’ [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è§£èª¬ã«æˆ»ã‚‹](03_ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è§£èª¬.html)**

</div>
</div>
      </article>
      <footer class="footer">
        GCP AI Agent è¨­è¨ˆè³‡æ–™ | Built with Python & Markdown
      </footer>
    </main>
  </div>

  <script>
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
    }

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', function(e) {
      const sidebar = document.getElementById('sidebar');
      const toggle = document.querySelector('.menu-toggle');
      if (!sidebar.contains(e.target) && !toggle.contains(e.target)) {
        sidebar.classList.remove('open');
      }
    });
  </script>
</body>
</html>